!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).MeetNow={})}(this,(function(e){"use strict";function t(e,t){return e(t={exports:{}},t.exports),t.exports}var n=1e3,r=6e4,o=36e5,a=24*o,i=function(e,t){t=t||{};var i=typeof e;if("string"===i&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!t)return;var i=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*i;case"weeks":case"week":case"w":return 6048e5*i;case"days":case"day":case"d":return i*a;case"hours":case"hour":case"hrs":case"hr":case"h":return i*o;case"minutes":case"minute":case"mins":case"min":case"m":return i*r;case"seconds":case"second":case"secs":case"sec":case"s":return i*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return i;default:return}}(e);if("number"===i&&isFinite(e))return t.long?function(e){var t=Math.abs(e);if(t>=a)return s(e,t,a,"day");if(t>=o)return s(e,t,o,"hour");if(t>=r)return s(e,t,r,"minute");if(t>=n)return s(e,t,n,"second");return e+" ms"}(e):function(e){var t=Math.abs(e);if(t>=a)return Math.round(e/a)+"d";if(t>=o)return Math.round(e/o)+"h";if(t>=r)return Math.round(e/r)+"m";if(t>=n)return Math.round(e/n)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function s(e,t,n,r){var o=t>=1.5*n;return Math.round(e/n)+" "+r+(o?"s":"")}var c=function(e){function t(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return n.colors[Math.abs(t)%n.colors.length]}function n(e){let a;function i(...e){if(!i.enabled)return;const t=i,r=Number(new Date);t.diff=r-(a||r),t.prev=a,t.curr=r,a=r,e[0]=n.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let o=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(r,a)=>{if("%%"===r)return r;o++;const i=n.formatters[a];if("function"==typeof i){r=i.call(t,e[o]),e.splice(o,1),o--}return r}),n.formatArgs.call(t,e),(t.log||n.log).apply(t,e)}return i.namespace=e,i.enabled=n.enabled(e),i.useColors=n.useColors(),i.color=t(e),i.destroy=r,i.extend=o,"function"==typeof n.init&&n.init(i),n.instances.push(i),i}function r(){const e=n.instances.indexOf(this);return-1!==e&&(n.instances.splice(e,1),!0)}function o(e,t){const r=n(this.namespace+(void 0===t?":":t)+e);return r.log=this.log,r}function a(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return n.debug=n,n.default=n,n.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},n.disable=function(){const e=[...n.names.map(a),...n.skips.map(a).map(e=>"-"+e)].join(",");return n.enable(""),e},n.enable=function(e){let t;n.save(e),n.names=[],n.skips=[];const r=("string"==typeof e?e:"").split(/[\s,]+/),o=r.length;for(t=0;t<o;t++)r[t]&&("-"===(e=r[t].replace(/\*/g,".*?"))[0]?n.skips.push(new RegExp("^"+e.substr(1)+"$")):n.names.push(new RegExp("^"+e+"$")));for(t=0;t<n.instances.length;t++){const e=n.instances[t];e.enabled=n.enabled(e.namespace)}},n.enabled=function(e){if("*"===e[e.length-1])return!0;let t,r;for(t=0,r=n.skips.length;t<r;t++)if(n.skips[t].test(e))return!1;for(t=0,r=n.names.length;t<r;t++)if(n.names[t].test(e))return!0;return!1},n.humanize=i,Object.keys(e).forEach(t=>{n[t]=e[t]}),n.instances=[],n.names=[],n.skips=[],n.formatters={},n.selectColor=t,n.enable(n.load()),n},u=t((function(e,t){t.log=function(...e){return"object"==typeof console&&console.log&&console.log(...e)},t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;t.splice(1,0,n,"color: inherit");let r=0,o=0;t[0].replace(/%[a-zA-Z%]/g,e=>{"%%"!==e&&(r++,"%c"===e&&(o=r))}),t.splice(o,0,n)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG);return e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.exports=c(t);const{formatters:n}=e.exports;n.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}})),d=function(e,t){return function(){for(var n=new Array(arguments.length),r=0;r<n.length;r++)n[r]=arguments[r];return e.apply(t,n)}},l=Object.prototype.toString;function f(e){return"[object Array]"===l.call(e)}function p(e){return null!==e&&"object"==typeof e}function m(e){return"[object Function]"===l.call(e)}function g(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),f(e))for(var n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.call(null,e[o],o,e)}var h={isArray:f,isArrayBuffer:function(e){return"[object ArrayBuffer]"===l.call(e)},isBuffer:function(e){return null!=e&&null!=e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){return"undefined"!=typeof FormData&&e instanceof FormData},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:p,isUndefined:function(e){return void 0===e},isDate:function(e){return"[object Date]"===l.call(e)},isFile:function(e){return"[object File]"===l.call(e)},isBlob:function(e){return"[object Blob]"===l.call(e)},isFunction:m,isStream:function(e){return p(e)&&m(e.pipe)},isURLSearchParams:function(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&("undefined"!=typeof window&&"undefined"!=typeof document)},forEach:g,merge:function e(){var t={};function n(n,r){t[r]="object"==typeof t[r]&&"object"==typeof n?e(t[r],n):n}for(var r=0,o=arguments.length;r<o;r++)g(arguments[r],n);return t},deepMerge:function e(){var t={};function n(n,r){t[r]="object"==typeof t[r]&&"object"==typeof n?e(t[r],n):"object"==typeof n?e({},n):n}for(var r=0,o=arguments.length;r<o;r++)g(arguments[r],n);return t},extend:function(e,t,n){return g(t,(function(t,r){e[r]=n&&"function"==typeof t?d(t,n):t})),e},trim:function(e){return e.replace(/^\s*/,"").replace(/\s*$/,"")}};function y(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var w=function(e,t,n){if(!t)return e;var r;if(n)r=n(t);else if(h.isURLSearchParams(t))r=t.toString();else{var o=[];h.forEach(t,(function(e,t){null!=e&&(h.isArray(e)?t+="[]":e=[e],h.forEach(e,(function(e){h.isDate(e)?e=e.toISOString():h.isObject(e)&&(e=JSON.stringify(e)),o.push(y(t)+"="+y(e))})))})),r=o.join("&")}if(r){var a=e.indexOf("#");-1!==a&&(e=e.slice(0,a)),e+=(-1===e.indexOf("?")?"?":"&")+r}return e};function v(){this.handlers=[]}v.prototype.use=function(e,t){return this.handlers.push({fulfilled:e,rejected:t}),this.handlers.length-1},v.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},v.prototype.forEach=function(e){h.forEach(this.handlers,(function(t){null!==t&&e(t)}))};var b=v,k=function(e,t,n){return h.forEach(n,(function(n){e=n(e,t)})),e},C=function(e){return!(!e||!e.__CANCEL__)},S=function(e,t){h.forEach(e,(function(n,r){r!==t&&r.toUpperCase()===t.toUpperCase()&&(e[t]=n,delete e[r])}))},T=function(e,t,n,r,o){return function(e,t,n,r,o){return e.config=t,n&&(e.code=n),e.request=r,e.response=o,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},e}(new Error(e),t,n,r,o)},E=function(e,t,n){var r=n.config.validateStatus;!r||r(n.status)?e(n):t(T("Request failed with status code "+n.status,n.config,null,n.request,n))},R=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"],x=h.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a");function r(e){var r=e;return t&&(n.setAttribute("href",r),r=n.href),n.setAttribute("href",r),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:"/"===n.pathname.charAt(0)?n.pathname:"/"+n.pathname}}return e=r(window.location.href),function(t){var n=h.isString(t)?r(t):t;return n.protocol===e.protocol&&n.host===e.host}}():function(){return!0},O=h.isStandardBrowserEnv()?{write:function(e,t,n,r,o,a){var i=[];i.push(e+"="+encodeURIComponent(t)),h.isNumber(n)&&i.push("expires="+new Date(n).toGMTString()),h.isString(r)&&i.push("path="+r),h.isString(o)&&i.push("domain="+o),!0===a&&i.push("secure"),document.cookie=i.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}},A=function(e){return new Promise((function(t,n){var r=e.data,o=e.headers;h.isFormData(r)&&delete o["Content-Type"];var a=new XMLHttpRequest;e.auth&&(o.Authorization="Basic "+btoa((e.auth.username||"")+":"+(e.auth.password||"")));if(a.open(e.method.toUpperCase(),w(e.url,e.params,e.paramsSerializer),!0),a.timeout=e.timeout,a.onreadystatechange=function(){if(a&&4===a.readyState&&(0!==a.status||a.responseURL&&0===a.responseURL.indexOf("file:"))){var r="getAllResponseHeaders"in a?function(e){var t,n,r,o={};return e?(h.forEach(e.split("\n"),(function(e){if(r=e.indexOf(":"),t=h.trim(e.substr(0,r)).toLowerCase(),n=h.trim(e.substr(r+1)),t){if(o[t]&&R.indexOf(t)>=0)return;o[t]="set-cookie"===t?(o[t]?o[t]:[]).concat([n]):o[t]?o[t]+", "+n:n}})),o):o}(a.getAllResponseHeaders()):null;E(t,n,{data:e.responseType&&"text"!==e.responseType?a.response:a.responseText,status:a.status,statusText:a.statusText,headers:r,config:e,request:a}),a=null}},a.onabort=function(){a&&(n(T("Request aborted",e,"ECONNABORTED",a)),a=null)},a.onerror=function(){n(T("Network Error",e,null,a)),a=null},a.ontimeout=function(){n(T("timeout of "+e.timeout+"ms exceeded",e,"ECONNABORTED",a)),a=null},h.isStandardBrowserEnv()){var i=O,s=(e.withCredentials||x(e.url))&&e.xsrfCookieName?i.read(e.xsrfCookieName):void 0;s&&(o[e.xsrfHeaderName]=s)}if("setRequestHeader"in a&&h.forEach(o,(function(e,t){void 0===r&&"content-type"===t.toLowerCase()?delete o[t]:a.setRequestHeader(t,e)})),e.withCredentials&&(a.withCredentials=!0),e.responseType)try{a.responseType=e.responseType}catch(t){if("json"!==e.responseType)throw t}"function"==typeof e.onDownloadProgress&&a.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&a.upload&&a.upload.addEventListener("progress",e.onUploadProgress),e.cancelToken&&e.cancelToken.promise.then((function(e){a&&(a.abort(),n(e),a=null)})),void 0===r&&(r=null),a.send(r)}))},F={"Content-Type":"application/x-www-form-urlencoded"};function N(e,t){!h.isUndefined(e)&&h.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var M,j={adapter:("undefined"!=typeof process&&"[object process]"===Object.prototype.toString.call(process)?M=A:"undefined"!=typeof XMLHttpRequest&&(M=A),M),transformRequest:[function(e,t){return S(t,"Accept"),S(t,"Content-Type"),h.isFormData(e)||h.isArrayBuffer(e)||h.isBuffer(e)||h.isStream(e)||h.isFile(e)||h.isBlob(e)?e:h.isArrayBufferView(e)?e.buffer:h.isURLSearchParams(e)?(N(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):h.isObject(e)?(N(t,"application/json;charset=utf-8"),JSON.stringify(e)):e}],transformResponse:[function(e){if("string"==typeof e)try{e=JSON.parse(e)}catch(e){}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function(e){return e>=200&&e<300}};j.headers={common:{Accept:"application/json, text/plain, */*"}},h.forEach(["delete","get","head"],(function(e){j.headers[e]={}})),h.forEach(["post","put","patch"],(function(e){j.headers[e]=h.merge(F)}));var L=j;function U(e){e.cancelToken&&e.cancelToken.throwIfRequested()}var I=function(e){return U(e),e.baseURL&&!/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e.url)&&(e.url=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}(e.baseURL,e.url)),e.headers=e.headers||{},e.data=k(e.data,e.headers,e.transformRequest),e.headers=h.merge(e.headers.common||{},e.headers[e.method]||{},e.headers||{}),h.forEach(["delete","get","head","post","put","patch","common"],(function(t){delete e.headers[t]})),(e.adapter||L.adapter)(e).then((function(t){return U(e),t.data=k(t.data,t.headers,e.transformResponse),t}),(function(t){return C(t)||(U(e),t&&t.response&&(t.response.data=k(t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)}))},P=function(e,t){t=t||{};var n={};return h.forEach(["url","method","params","data"],(function(e){void 0!==t[e]&&(n[e]=t[e])})),h.forEach(["headers","auth","proxy"],(function(r){h.isObject(t[r])?n[r]=h.deepMerge(e[r],t[r]):void 0!==t[r]?n[r]=t[r]:h.isObject(e[r])?n[r]=h.deepMerge(e[r]):void 0!==e[r]&&(n[r]=e[r])})),h.forEach(["baseURL","transformRequest","transformResponse","paramsSerializer","timeout","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","maxContentLength","validateStatus","maxRedirects","httpAgent","httpsAgent","cancelToken","socketPath"],(function(r){void 0!==t[r]?n[r]=t[r]:void 0!==e[r]&&(n[r]=e[r])})),n};function $(e){this.defaults=e,this.interceptors={request:new b,response:new b}}$.prototype.request=function(e){"string"==typeof e?(e=arguments[1]||{}).url=arguments[0]:e=e||{},(e=P(this.defaults,e)).method=e.method?e.method.toLowerCase():"get";var t=[I,void 0],n=Promise.resolve(e);for(this.interceptors.request.forEach((function(e){t.unshift(e.fulfilled,e.rejected)})),this.interceptors.response.forEach((function(e){t.push(e.fulfilled,e.rejected)}));t.length;)n=n.then(t.shift(),t.shift());return n},$.prototype.getUri=function(e){return e=P(this.defaults,e),w(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")},h.forEach(["delete","get","head","options"],(function(e){$.prototype[e]=function(t,n){return this.request(h.merge(n||{},{method:e,url:t}))}})),h.forEach(["post","put","patch"],(function(e){$.prototype[e]=function(t,n,r){return this.request(h.merge(r||{},{method:e,url:t,data:n}))}}));var q=$;function D(e){this.message=e}D.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},D.prototype.__CANCEL__=!0;var B=D;function z(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise((function(e){t=e}));var n=this;e((function(e){n.reason||(n.reason=new B(e),t(n.reason))}))}z.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},z.source=function(){var e;return{token:new z((function(t){e=t})),cancel:e}};var _=z;function H(e){var t=new q(e),n=d(q.prototype.request,t);return h.extend(n,q.prototype,t),h.extend(n,t),n}var W=H(L);W.Axios=q,W.create=function(e){return H(P(W.defaults,e))},W.Cancel=B,W.CancelToken=_,W.isCancel=C,W.all=function(e){return Promise.all(e)},W.spread=function(e){return function(t){return e.apply(null,t)}};var V=W;V.default=W;var J=V;function G(e){const t=String(e);let n,r,o=0,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i="";for(;t.charAt(0|o)||(a="=",o%1);i+=a.charAt(63&n>>8-o%1*8)){if(r=t.charCodeAt(o+=.75),r>255)throw new Error('"btoa" failed: The string to be encoded contains characters outside of the Latin1 range.');n=n<<8|r}return i}var Z;!function(e){e[e.kUnknown=0]="kUnknown",e[e.kWechat=1]="kWechat",e[e.kAlipay=2]="kAlipay",e[e.kBaidu=3]="kBaidu"}(Z||(Z={}));const X=function(){switch(!0){case"object"==typeof wx:return Z.kWechat;case"object"==typeof swan:return Z.kBaidu;case"object"==typeof my:return Z.kAlipay;default:return Z.kUnknown}}(),K=X===Z.kWechat?wx.request.bind(wx):X===Z.kAlipay?(my.request||my.httpRequest).bind(my):X===Z.kBaidu?swan.request.bind(swan):void 0;function Q(){let e;return{send(t){K&&(e=K(t))},abort(){e&&e.abort()}}}function Y(e){return new Promise((function(t,n){const{url:r,data:o,headers:a,method:i,params:s,paramsSerializer:c,responseType:u,timeout:d,cancelToken:l}=e;if(e.auth){const[t,n]=[e.auth.username||"",e.auth.password||""];a.Authorization=`Basic ${G(`${t}:${n}`)}`}h.forEach(a,(e,t)=>{const n=t.toLowerCase();(void 0===o&&"content-type"===n||"referer"===n)&&delete a[t]});let f=function(e){let t,n,r,o,a,i;const s=Q();return{send(c){s.send(Object.spread({},c,{success:t=>{const n=t.statusCode||t.status||200;i&&i({data:t.data,status:n,statusText:200===n?"OK":400===n?"Bad Request":"",headers:t.header||t.headers,config:e,request:c})},fail:t=>{let n=!1,i=!1;switch(X){case Z.kWechat:-1!==t.errMsg.indexOf("request:fail abort")?n=!0:-1!==t.errMsg.indexOf("timeout")&&(i=!0);break;case Z.kAlipay:[14,19].includes(t.error)?n=!0:[13].includes(t.error)&&(i=!0)}const s=n?T("Request aborted",e,"ECONNABORTED",""):i?T("Request Timeout",e,"ECONNABORTED",""):T("Network Error",e,null,"");n&&r&&r(s),i&&a&&a(s),o&&o(s)},complete:()=>{t&&(clearTimeout(t),t=void 0)}})),n&&(t=setTimeout(()=>{a&&a(T(`timeout of ${e.timeout||0}ms exceeded`,e,"ECONNABORTED","")),t=void 0},n))},abort(){s.abort()},set timeout(e){n=e},set onabort(e){r=e},set onerror(e){o=e},set ontimeout(e){a=e},set onsuccess(e){i=e}}}(e);const p={url:w(r,s,c),header:a,method:i&&i.toUpperCase(),data:(m=o,"string"==typeof m?JSON.parse(o):o),responseType:u};var m;l&&l.promise.then(e=>{f&&(f.abort(),n(e),f=null)}),f.timeout=d,f.onsuccess=function(e){E(t,n,e),f=null},f.onabort=function(e){f&&(n(e),f=null)},f.onerror=function(e){f&&(n(e),f=null)},f.ontimeout=function(e){n(e),f=null},f.send(p)}))}function ee(e,t){const n=Object.keys(e);if(Object.getOwnPropertySymbols){let r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(t=>Object.getOwnPropertyDescriptor(e,t).enumerable)),n.push.apply(n,r)}return n}function te(e){for(let t=1;t<arguments.length;t++){const n=arguments[t];null!=n&&(Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ee(Object(n)).forEach(t=>{Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const ne=/version\/(\d+(\.?_?\d+)+)/i;function re(e,t){const n=t.match(e);return n&&n.length>0&&n[1]||""}function oe(e,t){const n=t.match(e);return n&&n.length>1&&n[2]||""}function ae(e,t){return{name:e,version:t,firefox:"firefox"===e,chrome:"chrome"===e||"chromium"===e,wechet:"wechat"===e,toString:()=>`${e.toUpperCase()} ${t}`}}const ie=[{test:[/micromessenger/i],describe:e=>ae("wechat",re(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,e)||re(ne,e))},{test:[/\sedg\//i],describe:e=>ae("edge",re(/\sedg\/(\d+(\.?_?\d+)+)/i,e))},{test:[/edg([ea]|ios)/i],describe:e=>ae("edge",oe(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,e))},{test:[/firefox|iceweasel|fxios/i],describe:e=>ae("firefox",re(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,e))},{test:[/chromium/i],describe:e=>ae("chromium",re(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,e)||re(ne,e))},{test:[/chrome|crios|crmo/i],describe:e=>ae("chrome",re(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,e))},{test:[/safari|applewebkit/i],describe:e=>ae("safari",re(ne,e))},{test:[/.*/i],describe(e){const t=-1!==e.search("\\(")?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return ae(re(t,e),oe(t,e))}}],se={};function ce(){return"object"==typeof wx||"object"==typeof swan||"object"==typeof my||/miniprogram/i.test(navigator.userAgent)||window&&"miniprogram"===window.__wxjs_environment}function ue(e){if(!se.browser){e=e||(ce()?"miniprogram":navigator.userAgent);const t=ie.find(t=>t.test.some(t=>t.test(e)));t&&(se.browser=t.describe(e))}return se.browser}function de(){return ue()}ue(),ce();const le=new class{constructor(){this.m=new Map}reset(e){this.m=new Map(Object.entries(e))}get(e,t){const n=this.m.get(e);return void 0!==n?n:t}getBoolean(e,t=!1){const n=this.m.get(e);return void 0===n?t:"string"==typeof n?"true"===n:!!n}getNumber(e,t){const n=parseFloat(this.m.get(e));return Number.isNaN(n)?void 0!==t?t:NaN:n}set(e,t){this.m.set(e,t)}};function fe(e){const t=ce()?wx:window,n=t.MeetNow=t.MeetNow||{},r=Object.spread({},(e=>{try{const t=e.sessionStorage.getItem("meetnow-persist-config");return null!==t?JSON.parse(t):{}}catch(e){return{}}})(t),{persistent:!1},e||n.config,(e=>{const t={};try{e.location.search.slice(1).split("&").map(e=>e.split("=")).map(([e,t])=>[decodeURIComponent(e),decodeURIComponent(t)]).filter(([e])=>{return e.substr(0,(t="meetnow:").length)===t;var t}).map(([e,t])=>[e.slice("meetnow:".length),t]).forEach(([e,n])=>{t[e]=n})}catch(e){return t}return t})(t));le.reset(r),le.getBoolean("persistent")&&((e,t)=>{try{e.sessionStorage.setItem("meetnow-persist-config",JSON.stringify(t))}catch(e){return}})(t,r),n.config=le,le.getBoolean("testing")&&le.set("debug","MN:*")}var pe=t((function(e){!function(){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n={rotl:function(e,t){return e<<t|e>>>32-t},rotr:function(e,t){return e<<32-t|e>>>t},endian:function(e){if(e.constructor==Number)return 16711935&n.rotl(e,8)|4278255360&n.rotl(e,24);for(var t=0;t<e.length;t++)e[t]=n.endian(e[t]);return e},randomBytes:function(e){for(var t=[];e>0;e--)t.push(Math.floor(256*Math.random()));return t},bytesToWords:function(e){for(var t=[],n=0,r=0;n<e.length;n++,r+=8)t[r>>>5]|=e[n]<<24-r%32;return t},wordsToBytes:function(e){for(var t=[],n=0;n<32*e.length;n+=8)t.push(e[n>>>5]>>>24-n%32&255);return t},bytesToHex:function(e){for(var t=[],n=0;n<e.length;n++)t.push((e[n]>>>4).toString(16)),t.push((15&e[n]).toString(16));return t.join("")},hexToBytes:function(e){for(var t=[],n=0;n<e.length;n+=2)t.push(parseInt(e.substr(n,2),16));return t},bytesToBase64:function(e){for(var n=[],r=0;r<e.length;r+=3)for(var o=e[r]<<16|e[r+1]<<8|e[r+2],a=0;a<4;a++)n.push(8*r+6*a<=8*e.length?t.charAt(o>>>6*(3-a)&63):"=");return n.join("")},base64ToBytes:function(e){e=e.replace(/[^A-Z0-9+\/]/gi,"");for(var n=[],r=0,o=0;r<e.length;o=++r%4)0!=o&&n.push((t.indexOf(e.charAt(r-1))&Math.pow(2,-2*o+8)-1)<<2*o|t.indexOf(e.charAt(r))>>>6-2*o);return n}};e.exports=n}()})),me={utf8:{stringToBytes:function(e){return me.bin.stringToBytes(unescape(encodeURIComponent(e)))},bytesToString:function(e){return decodeURIComponent(escape(me.bin.bytesToString(e)))}},bin:{stringToBytes:function(e){for(var t=[],n=0;n<e.length;n++)t.push(255&e.charCodeAt(n));return t},bytesToString:function(e){for(var t=[],n=0;n<e.length;n++)t.push(String.fromCharCode(e[n]));return t.join("")}}},ge=me,he=function(e){return null!=e&&(ye(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&ye(e.slice(0,0))}(e)||!!e._isBuffer)};function ye(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}var we=t((function(e){!function(){var t=pe,n=ge.utf8,r=he,o=ge.bin,a=function(e,i){e.constructor==String?e=i&&"binary"===i.encoding?o.stringToBytes(e):n.stringToBytes(e):r(e)?e=Array.prototype.slice.call(e,0):Array.isArray(e)||(e=e.toString());for(var s=t.bytesToWords(e),c=8*e.length,u=1732584193,d=-271733879,l=-1732584194,f=271733878,p=0;p<s.length;p++)s[p]=16711935&(s[p]<<8|s[p]>>>24)|4278255360&(s[p]<<24|s[p]>>>8);s[c>>>5]|=128<<c%32,s[14+(c+64>>>9<<4)]=c;var m=a._ff,g=a._gg,h=a._hh,y=a._ii;for(p=0;p<s.length;p+=16){var w=u,v=d,b=l,k=f;u=m(u,d,l,f,s[p+0],7,-680876936),f=m(f,u,d,l,s[p+1],12,-389564586),l=m(l,f,u,d,s[p+2],17,606105819),d=m(d,l,f,u,s[p+3],22,-1044525330),u=m(u,d,l,f,s[p+4],7,-176418897),f=m(f,u,d,l,s[p+5],12,1200080426),l=m(l,f,u,d,s[p+6],17,-1473231341),d=m(d,l,f,u,s[p+7],22,-45705983),u=m(u,d,l,f,s[p+8],7,1770035416),f=m(f,u,d,l,s[p+9],12,-1958414417),l=m(l,f,u,d,s[p+10],17,-42063),d=m(d,l,f,u,s[p+11],22,-1990404162),u=m(u,d,l,f,s[p+12],7,1804603682),f=m(f,u,d,l,s[p+13],12,-40341101),l=m(l,f,u,d,s[p+14],17,-1502002290),u=g(u,d=m(d,l,f,u,s[p+15],22,1236535329),l,f,s[p+1],5,-165796510),f=g(f,u,d,l,s[p+6],9,-1069501632),l=g(l,f,u,d,s[p+11],14,643717713),d=g(d,l,f,u,s[p+0],20,-373897302),u=g(u,d,l,f,s[p+5],5,-701558691),f=g(f,u,d,l,s[p+10],9,38016083),l=g(l,f,u,d,s[p+15],14,-660478335),d=g(d,l,f,u,s[p+4],20,-405537848),u=g(u,d,l,f,s[p+9],5,568446438),f=g(f,u,d,l,s[p+14],9,-1019803690),l=g(l,f,u,d,s[p+3],14,-187363961),d=g(d,l,f,u,s[p+8],20,1163531501),u=g(u,d,l,f,s[p+13],5,-1444681467),f=g(f,u,d,l,s[p+2],9,-51403784),l=g(l,f,u,d,s[p+7],14,1735328473),u=h(u,d=g(d,l,f,u,s[p+12],20,-1926607734),l,f,s[p+5],4,-378558),f=h(f,u,d,l,s[p+8],11,-2022574463),l=h(l,f,u,d,s[p+11],16,1839030562),d=h(d,l,f,u,s[p+14],23,-35309556),u=h(u,d,l,f,s[p+1],4,-1530992060),f=h(f,u,d,l,s[p+4],11,1272893353),l=h(l,f,u,d,s[p+7],16,-155497632),d=h(d,l,f,u,s[p+10],23,-1094730640),u=h(u,d,l,f,s[p+13],4,681279174),f=h(f,u,d,l,s[p+0],11,-358537222),l=h(l,f,u,d,s[p+3],16,-722521979),d=h(d,l,f,u,s[p+6],23,76029189),u=h(u,d,l,f,s[p+9],4,-640364487),f=h(f,u,d,l,s[p+12],11,-421815835),l=h(l,f,u,d,s[p+15],16,530742520),u=y(u,d=h(d,l,f,u,s[p+2],23,-995338651),l,f,s[p+0],6,-198630844),f=y(f,u,d,l,s[p+7],10,1126891415),l=y(l,f,u,d,s[p+14],15,-1416354905),d=y(d,l,f,u,s[p+5],21,-57434055),u=y(u,d,l,f,s[p+12],6,1700485571),f=y(f,u,d,l,s[p+3],10,-1894986606),l=y(l,f,u,d,s[p+10],15,-1051523),d=y(d,l,f,u,s[p+1],21,-2054922799),u=y(u,d,l,f,s[p+8],6,1873313359),f=y(f,u,d,l,s[p+15],10,-30611744),l=y(l,f,u,d,s[p+6],15,-1560198380),d=y(d,l,f,u,s[p+13],21,1309151649),u=y(u,d,l,f,s[p+4],6,-145523070),f=y(f,u,d,l,s[p+11],10,-1120210379),l=y(l,f,u,d,s[p+2],15,718787259),d=y(d,l,f,u,s[p+9],21,-343485551),u=u+w>>>0,d=d+v>>>0,l=l+b>>>0,f=f+k>>>0}return t.endian([u,d,l,f])};a._ff=function(e,t,n,r,o,a,i){var s=e+(t&n|~t&r)+(o>>>0)+i;return(s<<a|s>>>32-a)+t},a._gg=function(e,t,n,r,o,a,i){var s=e+(t&r|n&~r)+(o>>>0)+i;return(s<<a|s>>>32-a)+t},a._hh=function(e,t,n,r,o,a,i){var s=e+(t^n^r)+(o>>>0)+i;return(s<<a|s>>>32-a)+t},a._ii=function(e,t,n,r,o,a,i){var s=e+(n^(t|~r))+(o>>>0)+i;return(s<<a|s>>>32-a)+t},a._blocksize=16,a._digestsize=16,e.exports=function(e,n){if(null==e)throw new Error("Illegal argument "+e);var r=t.wordsToBytes(a(e,n));return n&&n.asBytes?r:n&&n.asString?o.bytesToString(r):t.bytesToHex(r)}}()}));const ve="get",be="post",ke="/conference-ctrl/api/v1/ctrl/",Ce="/user-manager/api/v1/",Se={getVirtualJWT:{method:ve,url:`${Ce}external/virtualJwt/party`},login:{method:be,url:`${Ce}login`},selectAccount:{method:be,url:`${Ce}login/selectAccount`},logout:{method:be,url:`${Ce}logout`},refreshToken:{method:ve,url:`${Ce}current/user/refreshToken`},sendMobileLoginVerifyCode:{method:be,url:`${Ce}sendMobileLoginVerifyCode`},getConferenceInfo:{method:ve,url:`${"/conference-manager/api/v1/"}external/conference/info`},getURL:{method:be,url:`${ke}get-url-by-long-num`},getFullInfo:{method:be,url:`${ke}get-conference-info`},getBasicInfo:{method:be,url:`${ke}get-short-info`},getBasicInfoOffline:{method:be,url:`${ke}get-short-info-offline`},getStats:{method:be,url:`${ke}get-call-stats`},polling:{method:be,url:`${ke}polling`},keepalive:{method:be,url:`${ke}user-keepalive`},joinFocus:{method:be,url:`${ke}join-focus`},joinWechat:{method:be,url:`${ke}join-wechat`},joinMedia:{method:be,url:`${ke}join-audio-video`},renegMedia:{method:be,url:`${ke}av-reneg`},joinShare:{method:be,url:`${ke}join-applicationsharing-v2`},leaveShare:{method:be,url:`${ke}bye-applicationsharing`},switchShare:{method:be,url:`${ke}applicationsharing-switch`},renegShare:{method:be,url:`${ke}applicationsharing-reneg`},pushMessage:{method:be,url:`${ke}im-info`},pullMessage:{method:be,url:`${ke}get-all-im-info`},muteAll:{method:be,url:`${ke}mute-all`},unmuteAll:{method:be,url:`${ke}unmute-all`},acceptLobbyUser:{method:be,url:`${ke}grant-lobby-user`},acceptLobbyUserAll:{method:be,url:`${ke}grant-lobby-all`},rejectLobbyUserAll:{method:be,url:`${ke}del-lobby-all`},waitLobbyUser:{method:be,url:`${ke}wait-lobby-user`},waitLobbyUserAll:{method:be,url:`${ke}wait-lobby-all`},rejectHandupAll:{method:be,url:`${ke}reject-all-hand-up`},deleteUser:{method:be,url:`${ke}delete-user`},setUserMedia:{method:be,url:`${ke}modify-user-media`},setUserRole:{method:be,url:`${ke}modify-user-role`},setUserDisplayText:{method:be,url:`${ke}edit-user-display-text`},holdUser:{method:be,url:`${ke}wait-lobby-user`},inviteUser:{method:be,url:`${ke}invite-user`},setFocusVideo:{method:be,url:`${ke}set-focus-video`},setSpeakMode:{method:be,url:`${ke}set-speak-mode`},setFreeLayout:{method:be,url:`${ke}set-free-layout`},setCustomizeLayout:{method:be,url:`${ke}set-customize-layout`},setGlobalLayout:{method:be,url:`${ke}set-global-layout`},setFecc:{method:be,url:`${ke}set-fecc`},setTitle:{method:be,url:`${ke}set-title`},sendTitle:{method:be,url:`${ke}send-title`},setRecord:{method:be,url:`${ke}record-operate`},setRTMP:{method:be,url:`${ke}rtmp-operate`},setLock:{method:be,url:`${ke}lock-conference`},leave:{method:be,url:`${ke}quit-conference`},end:{method:be,url:`${ke}end-conference`}},Te={msg:"Unknown Error",errorCode:-1};class Ee extends Error{constructor(e,t=Te){super(),this.name="ApiError",this.message=t.msg,this.errCode=t.errorCode,this.bizCode=e}}const Re=u("MN:Api:Request"),{isCancel:xe}=J;const Oe=u("MN:Api");function Ae(e={}){Oe("createApi()");const t=J.create(Object.spread({},{baseURL:"/"},e));return t.interceptors.response.use(e=>{const{ret:t,bizCode:n,error:r,data:o}=e.data;if(t<0)throw new Ee(n,r);if(0===t&&r)throw new Ee(n,r);return Oe("request success: %o",o),e},e=>{throw Oe("request error: %o",e),e}),{get interceptors(){return t.interceptors},request:function(e){return Oe(`request() "${e}"`),function(e,t=J){let n,r;return r={config:e,header:function(t){return e.headers=t,r},params:function(t){return e.params=t,r},data:function(t){return e.data=t,r},send:function(){return Re("send()"),n=J.CancelToken.source(),e.cancelToken=n.token,t(e)},cancel:function(e="canceled"){return Re("cancel()"),n&&n.cancel(e)}}}(Object.spread({},Se[e]),t)},delegate:t}}const Fe=e=>null!=e,{isArray:Ne}=Array,Me=e=>"function"==typeof e,{hasOwnProperty:je}=Object.prototype,Le=(e,t)=>je.call(e,t),Ue=/-(\w)/g,Ie=e=>e.replace(Ue,(e,t)=>t?t.toUpperCase():"");function Pe(e){const t=Ae({baseURL:le.get("baseurl","https://meetings.ylyun.com/webapp/"),timeout:le.get("timeout",0)});return t.interceptors.request.use(t=>(e&&(t.headers=t.headers||{},t.headers.token=Me(e)?e():e),t)),t}const $e=u("MN:Worker");function qe(e){let t,n=!1,r=!1,o=0,a=0;const{interval:i=o,work:s,cancel:c}=e;async function u(e=!0){s&&e&&(r=!0,await s(a++),r=!1),n&&(o=Me(i)?i():i,t=setTimeout(u,o))}return{config:e,get running(){return n},start:async function(e=!0){$e("start()"),n||(n=!0,await u(e))},stop:function(){$e("stop()"),n&&(t&&(clearTimeout(t),t=void 0),r&&c&&c(),n=!1)}}}var De;(De=e.AuthType||(e.AuthType={})).email="0",De.mobile="1",De.verifycode="9";const Be=u("MN:Events");function ze(e=Be){let t;const n={};function r(e,o){return Ne(e)?(e.forEach(e=>r(e,o)),t):((n[e]||(n[e]=[])).push(o),t)}function o(e,r){if(Ne(e))return e.forEach(e=>o(e,r)),t;const a=n[e];if(!a)return t;if(!r)return n[e]=null,t;let i,s=a.length;for(;s--;)if(i=a[s],i===r||i.fn===r){a.splice(s,1);break}return t}return t={on:r,off:o,once:function(e,n){function a(...t){o(e,a),n.apply(this,t)}return a.fn=n,r(e,a),t},emit:function(r,...o){e(`emit() "${r}"`);let a=n[r];if(!a)return t;a=a.length>1?function(e,t){let n=e.length-(t=t||0);const r=new Array(n);for(;n--;)r[n]=e[n+t];return r}(a):a;for(const t of a)try{t(...o)}catch(t){e(`invoke "${r}" callback failed: %o`,t)}return t}}}const _e=u("MN:Keepalive");function He(e){const{api:t}=e;let n,r=!1,o=e.interval||3e4,a=0;async function i(){let i,s;_e("keepalive()");try{r=!1,n=t.request("keepalive"),i=await n.send()}catch(t){if(s=t,r=xe(t),r)return;a++,o=function(e){_e(`computeNextTimeout() attempts: ${e}`);let t=Math.floor(Math.random()*Math.pow(2,e)+1);return t<2&&(t=2),t>30&&(t=30),1e3*t}(a),_e("keepalive error: %o",s),e.onError&&e.onError(s,a)}if(a>15&&e.onError&&e.onError(new Error("Max Attempts"),a),s)return;const{data:c={interval:o}}=i.data,{interval:u}=c;o=Math.min(1e3*u,o)}const s=qe({work:()=>i(),interval:()=>o,cancel:()=>n.cancel()});return Object.spread({},s,{keepalive:i})}const We=u("MN:Polling");function Ve(e){const{api:t}=e;let n,r=100,o=0,a=0;function i(t){if(!t)return;const{version:n,category:r,body:o}=t;if(!Fe(n)||n<=a)We(`illegal version: ${n}, current version: ${a}.`);else{switch(r){case"conference-info":e.onInformation&&e.onInformation(o);break;case"im-record":e.onMessage&&e.onMessage(o);break;case"port-change":e.onRenegotiate&&e.onRenegotiate(o);break;case"call-record-list":e.onCallRecord&&e.onCallRecord(o);break;case"quit-conference":e.onQuit&&e.onQuit(o);break;default:We(`unsupported category: ${r}`)}a=n}}async function s(){let s,c;We("poll()");let u=!1,d=!1;try{n=t.request("polling").data({version:a}),s=await n.send()}catch(t){if(c=t,u=xe(t),u)return;if(d=!!c&&[900408,901323].includes(c.bizCode),d)return;o++,r=function(e){We(`computeNextTimeout() attempts: ${e}`);let t=Math.floor(Math.random()*Math.pow(2,e)+1);return t<2&&(t=2),t>30&&(t=30),1e3*t}(o),We("polling error: %o",c),e.onError&&e.onError(c,o)}if(o>5&&e.onError&&e.onError(new Error("Max Attempts"),o),c)return;const{data:l}=s.data;try{i(l)}catch(c){We("process data failed. %o",c)}o=0}const c=qe({work:()=>s(),interval:()=>r,cancel:()=>n.cancel()});return Object.spread({},c,{poll:s,analyze:i})}const Je=u("MN:Reactive");function Ge(e,t){return t=t||ze(Je),new Proxy(e,{set(e,n,r,o){const a=e[n],i=Le(e,n),s=Reflect.set(e,n,r,o);return i||t.emit(`${Ie(n)}Added`,r),((e,t)=>e!==t&&(e==e||t==t))(r,a)&&t.emit(`${Ie(n)}Changed`,r,a),s}})}const Ze=u("MN:Information:Description");const Xe=u("MN:Information:State");const Ke=u("MN:Information:Layout");const Qe=u("MN:Information:Danmaku"),Ye={position:"top",type:"static",displayTime:30,repeatCount:2,repeatInterval:5,rollDirection:"R2L"};const et=u("MN:Information:View");function tt(e,t){const{api:n}=t,r=ze(et),o=Ge(c({}),r),a=function(e){async function t(t){Ke("setCustomizeLayout()"),t.viewer=t.viewer||"attendee",await e.request("setCustomizeLayout").data(t).send()}return{setLayout:async function(t){Ke("setLayout()"),await e.request("setFreeLayout").data(t).send()},setCustomizeLayout:t,setPresenterLayout:async function(e){Ke("setPresenterLayout()"),e.viewer="presenter",await t(e)},setAttendeeLayout:async function(e){Ke("setAttendeeLayout()"),e.viewer="attendee",await t(e)},setCastViewerLayout:async function(e){Ke("setCastViewerLayout()"),e.viewer="castviewer",await t(e)},setOSD:async function(t={name:!0,icon:!0}){Ke("setOSD()");const{name:n,icon:r}=t;await e.request("setGlobalLayout").data({"hide-osd-site-icon":r,"hide-osd-site-name":n}).send()},setSpeakMode:async function(t){Ke("setSpeakMode()"),await e.request("setSpeakMode").data({"speak-mode":t}).send()}}}(n),i=function(e){let t=Ye;return{setDanmaku:async function(n){Qe("setDanmaku()");const r=Object.spread({},t,{config:n}),{type:o,position:a,displayTime:i,repeatCount:s,repeatInterval:c,rollDirection:u}=r;await e.request("setTitle").data({type:o,position:a,"display-time":i,"repeat-count":s,"repeat-interval":c,"roll-direction":u}).send(),t=r},sendDanmaku:async function(t,n){Qe("sendDanmaku()");const{attendee:r=!0,castviewer:o=!0,presenter:a=!0}=n||{};await e.request("sendTitle").data({"display-text":t,"all-attendee":r,"all-castviewer":o,"all-presenter":a})}}}(n);let s;function c(e){return e.focusUserEntity=l(),e}function u(){return e["entity-view"].find(e=>"audio-video"===e.entity)}function d(){return u()["entity-state"]}function l(){return d()["focus-video-user-entity"]}return s=Object.spread({},r,{get data(){return e},get:t=>e[t]},a,i,{update:function(e){c(o),r.emit("updated",s)},getVideoView:u,getLayout:d,getFocusUserEntity:l,getDanmaku:function(){return u().title}})}const nt=u("MN:Information:Camera");var rt;!function(e){e.LEFT="PanLeft",e.RIGHT="PanRight",e.DOWN="TiltDown",e.UP="TiltUp",e.ZOOMOUT="ZoomOut",e.ZOOMIN="ZoomIn",e.FOCUSOUT="FocusOut",e.FOCUSIN="FocusIn"}(rt||(rt={}));const ot=u("MN:Information:User");function at(e,t){const{api:n,userId:r}=t,o=ze(ot),a=Ge(u({}),o),i=d(),s=function(e,t){async function n(n){nt("action()"),await e.request("setFecc").data({"user-entity":t,action:n}).send()}return{action:n,left:function(){return nt("left()"),n(rt.LEFT)},right:function(){return nt("right()"),n(rt.RIGHT)},down:function(){return nt("down()"),n(rt.DOWN)},up:function(){return nt("up()"),n(rt.UP)},zoomout:function(){return nt("zoomout()"),n(rt.ZOOMOUT)},zoomin:function(){return nt("zoomin()"),n(rt.ZOOMIN)},focusout:function(){return nt("focusout()"),n(rt.FOCUSOUT)},focusin:function(){return nt("focusin()"),n(rt.FOCUSIN)}}}(n,i);let c;function u(t){return t.displayText=e["display-text"],t.role=l(),t.hold=p(),t.audio=!v(),t.video=!b(),t.handup=k(),t.media=m(),t.sharing=C(),t}function d(){return e.entity}function l(){return e.roles&&e.roles.role}function f(t){return e.endpoint.find(e=>e["session-type"]===t)}function p(){const e=f("audio-video");return!!e&&"on-hold"===e.status}function m(){return!!f("audio-video")}function g(t){return e.endpoint.reduce((e,t)=>e.concat(t.media||[]),[]).find(e=>e.label===t)}function h(e){const t=g(e),{"media-ingress-filter":n={type:"unblock"},"media-egress-filter":r={type:"unblock"}}=t||{};return{ingress:n.type,egress:r.type}}function y(){return h("main-audio")}function w(){return h("main-video")}function v(){const{ingress:e}=y();return"block"===e}function b(){const{ingress:e}=w();return"block"===e}function k(){const{ingress:e}=y();return"unblocking"===e}function C(){const e=g("applicationsharing");return!!e&&"sendonly"===e.status}async function S(e){ot("setFilter()");const{label:t,enable:r}=e,o=c.getEndpoint("audio-video"),a=c.getMedia(t);await n.request("setUserMedia").data({"user-entity":i,"endpoint-entity":o.entity,"media-id":a.id,"media-ingress-filter":r?"unblock":"block"}).send()}async function T(e){ot("setAudioFilter()"),await S({label:"main-audio",enable:e})}return c=Object.spread({},o,{get data(){return e},get:t=>e[t],update:function(t){!t||"full"!==t.state&&e||(e=t),u(a),o.emit("updated",c)},getEntity:d,getUID:function(){return e["subject-id"]},getDisplayText:function(){return e["display-text"]},getRole:l,isCurrent:function(){return i===r},isAttendee:function(){return"attendee"===l()},isPresenter:function(){return"presenter"===l()},isCastviewer:function(){return"castviewer"===l()},isOrganizer:function(){return"organizer"===l()},getEndpoint:f,isOnHold:p,hasFocus:function(){return!!f("focus")},hasMedia:m,hasSharing:function(){return!!f("applicationsharing")},hasFECC:function(){return!!f("fecc")},getMedia:g,getAudioFilter:y,getVideoFilter:w,isAudioBlocked:v,isVideoBlocked:b,isHandup:k,isSharing:C,isSIP:function(){return"sip"===e.protocol.toLowerCase()},isHTTP:function(){return"http"===e.protocol.toLowerCase()},isRTMP:function(){return"rtmp"===e.protocol.toLowerCase()},setFilter:S,setAudioFilter:T,setVideoFilter:async function(e){ot("setVideoFilter()"),await S({label:"main-video",enable:e})},setDisplayText:async function(e){ot("setDisplayText()"),await n.request("setUserDisplayText").data({"user-entity":i,"display-text":e}).send()},setRole:async function(e){ot("setRole()"),await n.request("setUserRole").data({"user-entity":i,role:e}).send()},setFocus:async function(e=!0){ot("setFocus()"),await n.request("setFocusVideo").data({"user-entity":e?i:""}).send()},getStats:async function(){ot("getStats()");const{data:e}=await n.request("getStats").data({"user-entity-list":[i]}).send();return e},kick:async function(){ot("kick()"),await n.request("deleteUser").data({"user-entity":i}).send()},hold:async function(){ot("hold()"),await n.request("waitLobbyUser").data({"user-entity":i}).send()},unhold:async function(){ot("unhold()"),await n.request("acceptLobbyUser").data({"user-entity":i}).send()},allow:async function(){ot("allow()"),await n.request("acceptLobbyUser").data({"user-entity":i}).send()},accept:async function(){ot("accept()"),await T(!0)},reject:async function(){ot("reject()"),await T(!1)},sendMessage:async function(e){ot("sendMessage()");const{chatChannel:n}=t;n&&n.ready&&await n.sendMessage(e,[i])},camera:s})}const it=u("MN:Information:Lobby");const st=u("MN:Information:Users");function ct(e,t){const{api:n}=t,r=ze(st),o=new Map;let a,i;const s=Ge(u({}),r),c=function(e){async function t(t){it("unhold()");const n=t?"acceptLobbyUser":"acceptLobbyUserAll";await e.request(n).data({"user-entity":t}).send()}return{remove:async function(t){it("remove()");const n=t?"deleteUser":"rejectLobbyUserAll";await e.request(n).data({"user-entity":t}).send()},unhold:t,hold:async function(t){it("hold()");const n=t?"waitLobbyUser":"waitLobbyUserAll";await e.request(n).data({"user-entity":t}).send()},allow:async function(e){it("allow()"),await t(e)}}}(n);function u(n){return a=e.user.map(e=>{const{entity:n}=e;let r=o.get(n);return r||(r=at(e,t),o.set(n,r)),r}),n}function d(e){return o.has(e)}return i=Object.spread({},r,{get data(){return e},get:t=>e[t]},c,{update:function(e){const t=[],n=[],a=[];if(e){const{user:r}=e;r.forEach(e=>{const{entity:r,state:o}=e;d(r)?"deleted"===o?a.push(e):n.push(e):t.push(e)})}u(s),t.forEach(e=>{const{entity:t}=e,n=o.get(t);st("added user:\n\n %s(%s) \n",n.getDisplayText(),n.getEntity()),i.emit("user:added",n)}),n.forEach(e=>{const{entity:t}=e,n=o.get(t);n.update(e),st("updated user:\n\n %s(%s)  \n",n.getDisplayText(),n.getEntity()),i.emit("user:updated",n)}),a.forEach(e=>{const{entity:t}=e,n=o.get(t);st("deleted user:\n\n %s(%s)  \n",n.getDisplayText(),n.getEntity()),i.emit("user:deleted",n),o.delete(t)}),r.emit("updated",i)},getUserList:function(e){return e?a.filter(e):a},getUser:function(e){return o.get(e)},hasUser:d,getCurrent:function(){return a.find(e=>e.isCurrent())},getAttendee:function(){return a.filter(e=>e.isAttendee()&&!e.isOnHold())},getPresenter:function(){return a.filter(e=>e.isPresenter())},getCastviewer:function(){return a.filter(e=>e.isCastviewer())},getOrganizer:function(){return a.filter(e=>e.isOrganizer())},getOnhold:function(){return a.filter(e=>e.isOnHold())},getHandup:function(){return a.filter(e=>e.isHandup())},getSharing:function(){return a.filter(e=>e.isSharing())},getAudioBlocked:function(){return a.filter(e=>e.isAudioBlocked())},getVideoBlocked:function(){return a.filter(e=>e.isVideoBlocked())},getSIP:function(){return a.filter(e=>e.isSIP())},getHTTP:function(){return a.filter(e=>e.isHTTP())},getRTMP:function(){return a.filter(e=>e.isRTMP())},invite:async function(e){st("invite"),await n.request("inviteUser").data({"teams-url":e.teamsURL,"sip-url":e.sipURL,"h323-url":e.h323URL}).send()},kick:async function(e){st("kick"),await n.request("deleteUser").data({"user-entity":e}).send()},mute:async function(){st("mute"),await n.request("muteAll").send()},unmute:async function(){st("unmute"),await n.request("unmuteAll").send()},reject:async function(){st("reject"),await n.request("rejectHandupAll").send()}})}const ut=u("MN:Information:RTMP");var dt;!function(e){e.START="start",e.STOP="stop",e.PAUSE="pause",e.RESUME="resume"}(dt||(dt={}));const lt=u("MN:Information:RTMP");function ft(e,t){const{api:n}=t,r=ze(lt),o=Ge(s({}),r),a=function(e){async function t(t){ut("operation"),await e.request("setRTMP").data({operate:t}).send()}return{operation:t,start:function(){return ut("start"),t(dt.START)},stop:function(){return ut("stop"),t(dt.STOP)},pause:function(){return ut("pause"),t(dt.PAUSE)},resume:function(){return ut("resume"),t(dt.RESUME)}}}(n);let i;function s(e){return e.enable=u(),e.status=d(),e}function c(t){return t?e.users.find(e=>e.entity===t):e.users.find(e=>e.default)||e.users[0]}function u(){return e["rtmp-enable"]}function d(e){const t=c(e);return t&&t["rtmp-status"]}return i=Object.spread({},r,{get data(){return e},get:t=>e[t],update:function(e){s(o),r.emit("updated",i)},getEnable:u,getStatus:d,getReason:function(e){const t=c(e);return t&&t.reason},getDetail:function(e){const t=c(e);if(!t)return;const{"rtmp-status":n,"rtmp-last-start-time":r,"rtmp-last-stop-duration":o,reason:a}=t;return{reason:a,status:n,lastStartTime:r,lastStopDuration:o}}},a)}const pt=u("MN:Information:Record");var mt;!function(e){e.START="start",e.STOP="stop",e.PAUSE="pause",e.RESUME="resume"}(mt||(mt={}));const gt=u("MN:Information:Record");function ht(e,t){const{api:n}=t,r=ze(gt),o=Ge(s({}),r),a=function(e){async function t(t){await e.request("setRecord").data({operate:t}).send()}return{operation:t,start:function(){return pt("start()"),t(mt.START)},stop:function(){return pt("stop()"),t(mt.STOP)},pause:function(){return pt("pause()"),t(mt.PAUSE)},resume:function(){return pt("resume()"),t(mt.RESUME)}}}(n);let i;function s(e){return e.status=u(),e}function c(){return e.user}function u(){return c()["record-status"]}return i=Object.spread({},r,{get data(){return e},get:t=>e[t],update:function(e){s(o),r.emit("updated",i)},getStatus:u,getReason:function(){return c().reason},getDetail:function(){const e=c(),{"record-status":t,"record-last-start-time":n,"record-last-stop-duration":r,reason:o}=e;return{reason:o,status:t,lastStartTime:n,lastStopDuration:r}}},a)}const yt=u("MN:Information:Item");function wt(e){return Fe(e)&&("object"==typeof(t=e)&&null!==t)&&!Ne(e);var t}function vt(e){return wt(e)&&Le(e,"state")}function bt(e,t){yt("mergelist()");for(const n of t){vt(n)||(yt("we don not know how to process a non-partialable item in a list, because it is undocumented"),yt("treat it as full state item"));const{id:t,entity:r,state:o="full"}=n,a=r||t;if(!a){yt("missing item identity(entity or id).");continue}const i=e.findIndex(e=>e.entity===a||e.id===a);if(yt("item identity: %o",a),-1!==i)"full"!==o?"deleted"!==o?kt(e[i],n):(yt("item deleted"),e.splice(i,1)):e.splice(i,1,n);else{if("deleted"===o){yt("can not delete item not exist.");continue}yt("item added"),e.push(n)}}return e}function kt(e,t){if(yt("merge()"),e===t)return e;if(!vt(t))return t;const{state:n}=t;if("full"===n)return t;if("deleted"===n)return null;"partial"!==n&&(yt(`Error: unknown item state. ${n}`),yt('use merge policy as "partial"'));for(const n in t)if(Le(t,n)){const r=t[n],o=e[n];yt("item key: %s value: %o -> %o",n,o,r),e[n]=Ne(r)?bt(o,r):wt(r)?kt(o,r):r}return e}const Ct=u("MN:Information");function St(e,t){const n=ze(Ct),{api:r}=t;function o(t){return new Proxy({},{get(n,r){const o=e[t];return o&&Reflect.get(o,r)}})}const a=function(e,t){const{api:n}=t,r=ze(Ze),o=Ge(i({}),r);let a;function i(e){return e.locked=u(),e}function s(){return{admissionPolicy:e["admission-policy"],attendeeByPass:e["attendee-by-pass"]}}async function c(e){Ze("setLock()");const{admissionPolicy:t,attendeeByPass:r=!0}=e;await n.request("setLock").data({"admission-policy":t,"attendee-lobby-bypass":r}).send()}function u(){return"anonymous"!==s().admissionPolicy}return a=Object.spread({},r,{get data(){return e},get subject(){return e.subject},get:t=>e[t],update:function(e){i(o),r.emit("updated",a)},getLock:s,setLock:c,lock:async function(e=!1,t=!0){Ze("lock()"),await c({admissionPolicy:t?"closedAuthenticated":"openAuthenticated",attendeeByPass:e})},unlock:async function(){Ze("unlock()"),await c({admissionPolicy:"anonymous"})},isLocked:u})}(o("conference-description"),t),i=function(e,t){const n=ze(Xe),r=Ge(a({}),n);let o;function a(t){const{active:n,locked:r}=e;return t.active=n,t.locked=r,t.sharingUserEntity=i(),t.speechUserEntity=s(),t}function i(){const{applicationsharer:t}=e;return t.user&&t.user.entity}function s(){const{"speech-user-entity":t}=e;return t}return o=Object.spread({},n,{get data(){return e},get:t=>e[t],update:function(e){a(r),n.emit("updated",o)},getSharingUserEntity:i,getSpeechUserEntity:s,getSharingType:function(){const{applicationsharer:t}=e;return t.user&&t.user["share-type"]}})}(o("conference-state")),s=tt(o("conference-view"),t),c=ct(o("users"),t),u=ft(o("rtmp-state"),t),d=ht(o("record-users"),t);let l;return l=Object.spread({},n,{get data(){return e},get version(){return e&&e.version},get:t=>e[t],get description(){return a},get state(){return i},get view(){return s},get users(){return c},get rtmp(){return u},get record(){return d},update:function t(o){Ct("update()");const{version:f}=e,{version:p,state:m}=o;if(p){if(!(p<=f))return p-f>1?(Ct("information version jumped."),void r.request("getFullInfo").send().then(e=>t(e.data.data)).catch(e=>Ct("get full information failed: %o",e))):void("deleted"!==m?("full"===m?Object.assign(e,o):kt(e,o),[{key:"conference-description",part:a},{key:"conference-state",part:i},{key:"conference-view",part:s},{key:"users",part:c},{key:"rtmp-state",part:u},{key:"record-users",part:d}].forEach(e=>{const{key:t,part:n}=e;Le(o,t)&&n.update(o[t])}),n.emit("updated",l)):Ct("can not delete root information."));Ct("receive information with invalid version.")}else Ct("receive information without version.")}})}const Tt={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w\/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-\.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:e=>e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:e=>null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%d trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:e=>null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))? (\S*)(?: (\S*))?/,names:["value","direction","uri","config"],format:e=>`extmap:%d${e.direction?"/%s":"%v"} %s${e.config?" %s":""}`},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:e=>null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format(e){let t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v",t}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format(e){let t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_\/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:e=>null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{name:"content",reg:/^content:([^\s]*)/,format:"content:%s"},{name:"label",reg:/^label:([\d]*)/,format:"label:%d"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:e=>e.params?"rid:%s %s %s":"rid:%s %s"},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:e=>`imageattr:%s %s %s${e.dir2?" %s %s":""}`},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:e=>`simulcast:%s %s${e.dir2?" %s %s":""}`},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{push:"invalid",names:["value"]}]};function Et(e){return String(Number(e))===e?Number(e):e}function Rt(e,t,n){const r=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:r&&!t[e.name]&&(t[e.name]={});const o=e.push?{}:r?t[e.name]:t;!function(e,t,n,r){if(r&&!n)t[r]=Et(e[1]);else for(let r=0;r<n.length;r+=1)null!=e[r+1]&&(t[n[r]]=Et(e[r+1]))}(n.match(e.reg),o,e.names,e.name),e.push&&t[e.push].push(o)}Object.keys(Tt).forEach(e=>{Tt[e].forEach(e=>{e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")})});const xt=RegExp.prototype.test.bind(/^([a-z])=(.*)/);function Ot(e){const t=[],n={media:t};let r=n;return e.split(/(\r\n|\r|\n)/).filter(xt).forEach(e=>{const n=e[0],o=e.slice(2);"m"===n&&(t.push({rtp:[],fmtp:[]}),r=t[t.length-1]);for(let e=0;e<(Tt[n]||[]).length;e+=1){const t=Tt[n][e];if(t.reg.test(o))return void Rt(t,r,o)}}),n.media=t,n}const At=/%[sdv%]/g,Ft=function(e,t,n){const r=`${e}=${t.format instanceof Function?t.format(t.push?n:n[t.name]):t.format}`,o=[];if(t.names)for(let e=0;e<t.names.length;e+=1){const r=t.names[e];o.push(t.name?n[t.name][r]:n[t.names[e]])}else o.push(n[t.name]);return function(e,...t){let n=0;const r=t.length;return e.replace(At,e=>{if(n>=r)return e;const o=t[n];switch(n+=1,e){case"%%":return"%";case"%s":return String(o);case"%d":return Number(o);case"%v":return"";default:return o}})}(r,...o)},Nt=["v","o","s","i","u","e","p","c","b","t","r","z","a"],Mt=["i","c","b","a"];function jt(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach(e=>{null==e.payloads&&(e.payloads="")});const n=t.innerOrder||Mt,r=[];return(t.outerOrder||Nt).forEach(t=>{Tt[t].forEach(n=>{n.name in e&&null!=e[n.name]?r.push(Ft(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach(e=>{r.push(Ft(t,n,e))})})}),e.media.forEach(e=>{r.push(Ft("m",Tt.m[0],e)),n.forEach(t=>{Tt[t].forEach(n=>{n.name in e&&null!=e[n.name]?r.push(Ft(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach(e=>{r.push(Ft(t,n,e))})})})}),`${r.join("\r\n")}\r\n`}function Lt(e){if(e)try{e.getTracks?e.getTracks().forEach(e=>e.stop()):(e.getAudioTracks().forEach(e=>e.stop()),e.getVideoTracks().forEach(e=>e.stop()))}catch(t){"function"!=typeof e.stop&&"object"!=typeof e.stop||e.stop()}}async function Ut(e){let t;if(navigator.mediaDevices.getUserMedia)t=await navigator.mediaDevices.getUserMedia(e);else{if(!navigator.getUserMedia)throw new Error("Not Supported");t=await new Promise((t,n)=>{navigator.getUserMedia(e,t,n)})}return function(e){return e.close=e.stop=function(){Lt(this)},e.pause=function(){this.getTracks().forEach(e=>e.enabled=!1)},e.play=function(){this.getTracks().forEach(e=>e.enabled=!0)},e.muteAudio=function(e=!0){this.getAudioTracks().forEach(t=>t.enabled=!e)},e.muteVideo=function(e=!0){this.getVideoTracks().forEach(t=>t.enabled=!e)},e}(t)}function It(){let e=-1,t={},n={},r=[];let o;function a(e,t){const n=e.get(t.codecId),r=e.get(t.trackId),o=e.get(t.transportId),a=e.get(t.remoteId);if(n&&(n.name=n.mimeType.split("/")[1]),o){const t=e.get(o.localCertificateId),n=e.get(o.remoteCertificateId),r=e.get(o.selectedCandidatePairId);o.localCertificate=t,o.remoteCertificate=n,o.selectedCandidatePair=r}return a&&(t.packetsLost=a.packetsLost||t.packetsLost),t.codec=n,t.track=r,t.transport=o,t}function i(e,t){if(!e)return;const n=o[t][e.mediaType],r=(e={},t={},n)=>void 0!==e[n]&&void 0!==t[n]?Math.abs(e[n]-t[n]):0,a=e=>Number.isFinite(e)?Number.isNaN(e)?0:e:0;if(n){if(!n.trackId||Boolean(e.trackId)){const i=r(e,n,"timestamp");let c;if("outbound"===t&&!e.packetsLostRate){const n=s()[t][e.mediaType],o=r(e,n,"packetsLost"),i=o+r(e,n,"packetsSent");e.packetsLostRate=0===i?0:a(o/i),e.packetsLostRate*=100}if("inbound"===t&&!e.packetsLostRate){const n=s()[t][e.mediaType],o=r(e,n,"packetsLost"),i=o+r(e,n,"packetsReceived");e.packetsLostRate=0===i?0:a(o/i),e.packetsLostRate*=100}"outbound"!==t||e.outgoingBitrate||(c=r(e,n,"bytesSent"),e.outgoingBitrate=a(8*c/i)),"inbound"!==t||e.incomingBitrate||(c=r(e,n,"bytesReceived"),e.incomingBitrate=a(8*c/i)),e.transport&&n.transport&&!e.transport.outgoingBitrate&&(c=r(e.transport,n.transport,"bytesSent"),e.transport.outgoingBitrate=a(8*c/i)),e.transport&&n.transport&&!e.transport.incomingBitrate&&(c=r(e.transport,n.transport,"bytesReceived"),e.transport.incomingBitrate=a(8*c/i)),"video"===e.mediaType&&e.track&&n.track&&!e.track.frameRate&&("inbound"===t&&(c=r(e.track,n.track,"framesReceived")),"outbound"===t&&(c=r(e.track,n.track,"framesSent")),e.track.frameRate=c?a(c/i*1e3):0),o[t][e.mediaType]=e}}else o[t][e.mediaType]=e}function s(e=0){const{length:t}=r;return e=Math.max(e,0),e=Math.min(e,t-1),r[e]}return o={get quality(){return e},get inbound(){return t},get outbound(){return n},update:function(o){const s={},c={};let u=!1;o.forEach(e=>{switch("function"==typeof e.stat&&(u=!0),e.type){case"codec":break;case"inbound-rtp":e.isRemote&&!1!==e.isRemote||(s[e.mediaType]=a(o,e));break;case"outbound-rtp":e.isRemote&&!1!==e.isRemote||(c[e.mediaType]=a(o,e));break;case"ssrc":!function(e,t,n=!1){n&&(t.mediaType=t.stat("mediaType"),t.googCodecName=t.stat("googCodecName"),t.codecImplementationName=t.stat("codecImplementationName"),t.googFrameHeightReceived=t.stat("googFrameHeightReceived"),t.googFrameHeightSent=t.stat("googFrameHeightSent"),t.googFrameWidthReceived=t.stat("googFrameWidthReceived"),t.googFrameWidthSent=t.stat("googFrameWidthSent"),t.googFrameRateReceived=t.stat("googFrameRateReceived"),t.googFrameRateSent=t.stat("googFrameRateSent"),t.packetsLost=t.stat("packetsLost"),t.packetsSent=t.stat("packetsSent"),t.packetsReceived=t.stat("packetsReceived"),t.bytesSent=t.stat("bytesSent"),t.bytesReceived=t.stat("bytesReceived"));const r={frameHeight:t.googFrameHeightReceived||t.googFrameHeightSent,frameWidth:t.googFrameWidthReceived||t.googFrameWidthSent,frameRate:t.googFrameRateReceived||t.googFrameRateSent};t.codec={name:t.googCodecName,implementationName:t.codecImplementationName},t.track=r}(0,e,u),/recv/g.test(e.id)&&(s[e.mediaType]=e),/send/g.test(e.id)&&(c[e.mediaType]=e)}}),i(s.audio,"inbound"),i(s.video,"inbound"),i(c.audio,"outbound"),i(c.video,"outbound");let d=0,l=0;if(t.audio&&(l++,d+=t.audio.packetsLostRate||0),t.video&&(l++,d+=t.video.packetsLostRate||0),l){const t=d/l;e=t>=12?0:t>=5?1:t>=3?2:t>=2?3:4}!function(){10===r.length&&r.shift();r.push({quality:e,inbound:t,outbound:n})}()},clear:function(){e=-1,t={},n={},r=[]}}}const Pt=u("MN:Channel"),$t=de();var qt;!function(e){e[e.kNull=0]="kNull",e[e.kProgress=1]="kProgress",e[e.kOffered=2]="kOffered",e[e.kAnswered=3]="kAnswered",e[e.kAccepted=4]="kAccepted",e[e.kCanceled=5]="kCanceled",e[e.kTerminated=6]="kTerminated"}(qt||(qt={}));const Dt=["audio","video"];function Bt(e){const{invite:t,confirm:n,cancel:r,bye:o,localstream:a}=e,i=ze(Pt);let s,c=qt.kNull,u=!1;const d=It();let l,f,p,m,g,h=!1,y=!1,w=!1,v=!1,b=!1;function k(e,t){if(c===e)throw new Error(t||"Invalid State")}function C(){if(u)throw new Error("Terminated");k(qt.kTerminated,"Terminated")}async function S(e,t){let n;if(Pt("createLocalDescription()"),y=!1,"offer"===e)try{n=await s.createOffer(t)}catch(e){throw Pt("createOffer failed: %o",e),i.emit("peerconnection:createofferfailed",e),e}else{if("answer"!==e)throw new TypeError("Invalid Type");try{n=await s.createAnswer(t)}catch(e){throw Pt("createAnswer failed: %o",e),i.emit("peerconnection:createanswerfailed",e),e}}try{await s.setLocalDescription(n)}catch(e){throw Pt("setLocalDescription failed: %o",e),y=!0,i.emit("peerconnection:setlocaldescriptionfailed",e),e}await new Promise(e=>{if("complete"===s.iceGatheringState)return void e();let t,n=!1;const r=()=>{s.removeEventListener("icecandidate",t),n=!0,e()};s.addEventListener("icecandidate",t=e=>{const{candidate:t}=e;t?i.emit("icecandidate",{candidate:t,ready:r}):n||r()})}),y=!0;const{sdp:r}=s.localDescription;return n={originator:"local",type:e,sdp:r},i.emit("sdp",n),n.sdp}async function T(e){switch(Pt("terminate()"),c){case qt.kNull:case qt.kTerminated:break;case qt.kProgress:case qt.kOffered:Pt("canceling channel"),c===qt.kOffered?await r(e):u=!0,c=qt.kCanceled,O("local",e||"Canceled");break;case qt.kAnswered:case qt.kAccepted:await o(e),t="local",n=e||"Terminated",Pt("channel ended"),g=new Date,E(),i.emit("ended",{originator:t,message:n})}var t,n}function E(){if(Pt("close()"),c!==qt.kTerminated){if(s)try{s.close(),s=void 0}catch(e){Pt("error closing RTCPeerConnection %o",e)}x(),p=void 0,h=!1,d.clear(),c=qt.kTerminated}}function R(){let e=!0,t=!0;b&&(e=!1,t=!1),w&&(e=!1),v&&(t=!1),function(e){s.getSenders().forEach(t=>{t.track&&"audio"===t.track.kind&&(t.track.enabled=!e)})}(!e),function(e){s.getSenders().forEach(t=>{t.track&&"video"===t.track.kind&&(t.track.enabled=!e)})}(!t)}function x(){p&&h&&(Lt(p),p=void 0,h=!1)}function O(e,t){Pt("channel failed"),E(),i.emit("failed",{originator:e,message:t})}async function A(e={}){if(Pt("renegotiate()"),!y)return void Pt("RTC not ready");const r=await S("offer",f),o={originator:"remote",type:"answer",sdp:(await t({sdp:F(r),renegotiate:!0})).sdp};i.emit("sdp",o);try{s.setRemoteDescription({type:"answer",sdp:o.sdp})}catch(e){throw i.emit("peerconnection:setremotedescriptionfailed",e),e}try{await n()}catch(e){throw O("local","Request Error"),Pt("confirm failed: %o",e),e}}function F(e){if(Pt("mangleOffer()"),!b)return e;const t=Ot(e);if(b)for(const e of t.media)-1!==Dt.indexOf(e.type)&&(e.direction?"sendrecv"===e.direction?e.direction="sendonly":"recvonly"===e.direction&&(e.direction="inactive"):e.direction="sendonly");else 0;return jt(t)}function N(){let e;return Pt("getLocalStream()"),s.getSenders?(e=new window.MediaStream,s.getSenders().forEach(t=>{const{track:n}=t;n&&e.addTrack(n)})):s.getLocalStreams&&(e=s.getLocalStreams()[0]),e}return Object.spread({},i,{get status(){return c},get connection(){return s},get startTime(){return m},get endTime(){return g},getConnectOptions:()=>({rtcConstraints:l,rtcOfferConstraints:f,localMediaStream:p,localMediaStreamLocallyGenerated:h}),isInProgress:function(){switch(c){case qt.kProgress:case qt.kOffered:case qt.kAnswered:return!0;default:return!1}},isEstablished:function(){return c===qt.kAccepted},isEnded:function(){switch(c){case qt.kCanceled:case qt.kTerminated:return!0;default:return!1}},getMute:function(){return{audio:w,video:v}},getHold:function(){return{local:b,remote:!1}},connect:async function(e={}){if(Pt("connect()"),k(qt.kProgress),k(qt.kOffered),k(qt.kAnswered),k(qt.kAccepted),!window.RTCPeerConnection)throw new Error("WebRTC not supported");var r,u;c=qt.kProgress,r="local",Pt("channel progress"),i.emit("progress",{originator:r,message:u}),i.emit("connecting"),({rtcConstraints:l={sdpSemantics:"plan-b",iceServers:[{urls:"stun:stun.l.google.com:19302"}]},rtcOfferConstraints:f={offerToReceiveAudio:!0,offerToReceiveVideo:!0}}=e);const{mediaStream:d,mediaConstraints:g={audio:!0,video:!0}}=e;if(function(e){Pt("createRTCConnection()"),s=new RTCPeerConnection(e),s.addEventListener("iceconnectionstatechange",()=>{if(!s)return;const{iceConnectionState:e}=s;"failed"===e&&(i.emit("peerconnection:connectionfailed"),T("RTP Timeout"))}),i.emit("peerconnection",s)}(l),d?(p=d,h=!1):(g.audio||g.video)&&(p=await Ut(g).catch(e=>{throw O("local","User Denied Media Access"),Pt("getusermedia failed: %o",e),e}),h=!0),C(),p){p.getTracks().forEach(e=>{s.addTrack(e,p)});try{await a(p)}catch(e){}}const y=await S("offer",f).catch(e=>{throw O("local","WebRTC Error"),Pt("createOff|setLocalDescription failed: %o",e),e});let w;C(),c=qt.kOffered;try{w=await t({sdp:y,renegotiate:!1})}catch(e){throw O("local","Request Error"),Pt("invite failed: %o",e),e}C(),c=qt.kAnswered;const{sdp:v}=w,b={originator:"remote",type:"answer",sdp:v};if(i.emit("sdp",b),"stable"===s.signalingState)try{const e=await s.createOffer();await s.setLocalDescription(e)}catch(e){throw O("local","WebRTC Error"),Pt("createOff|setLocalDescription failed: %o",e),await o(),e}try{await s.setRemoteDescription({type:"answer",sdp:b.sdp})}catch(e){throw O("remote","Bad Media Description"),i.emit("peerconnection:setremotedescriptionfailed",e),Pt("setRemoteDescription failed: %o",e),await o(),e}try{await n()}catch(e){throw O("local","Request Error"),Pt("confirm failed: %o",e),e}c=qt.kAccepted,function(e,t){Pt("channel accepted"),i.emit("accepted",{originator:e,message:t}),m=new Date}("local"),i.emit("connected")},terminate:T,renegotiate:A,mute:function(e={audio:!0,video:!1}){Pt("mute()");let t=!1;!1===w&&e.audio&&(t=!0,w=!0),!1===v&&e.video&&(t=!0,v=!0),t&&(R(),i.emit("mute",{audio:w,video:v}))},unmute:function(e={audio:!0,video:!0}){Pt("unmute()");let t=!1;!0===w&&e.audio&&(t=!0,w=!1),!0===v&&e.video&&(t=!0,v=!1),t&&(R(),i.emit("unmute",{audio:!w,video:!v}))},hold:async function(){var e;Pt("unhold()"),b?Pt("Already hold"):(b=!0,e="local",R(),i.emit("hold",{originator:e,localHold:b,remoteHold:!1}),await A())},unhold:async function(){var e;Pt("unhold()"),b?(b=!1,e="local",R(),i.emit("unhold",{originator:e,localHold:b,remoteHold:!1}),await A()):Pt("Already unhold")},getRemoteStream:function(){let e;return Pt("getRemoteStream()"),s.getReceivers?(e=new window.MediaStream,s.getReceivers().forEach(t=>{const{track:n}=t;n&&e.addTrack(n)})):s.getRemoteStreams&&(e=s.getRemoteStreams()[0]),e},getLocalStream:N,replaceLocalStream:async function(e,t=!1){Pt("replaceLocalStream()");const n=e?e.getAudioTracks()[0]:null,r=e?e.getVideoTracks()[0]:null,o=[];let i=!1,c=!1,u=!1;s.getSenders&&(s.getSenders().forEach(e=>{e.track&&(c="audio"===e.track.kind||c,u="video"===e.track.kind||u)}),i=Boolean(n)!==c||Boolean(r)!==u||t,x(),i?(Pt("removeLocalStream()"),s.getSenders&&s.removeTrack?s.getSenders().forEach(e=>{s.removeTrack(e)}):s.getLocalStreams&&s.removeStream&&s.getLocalStreams().forEach(e=>{s.removeStream(e)}),function(e){Pt("addLocalStream()"),e&&(s.addTrack?e.getTracks().forEach(t=>{s.addTrack(t,e)}):s.addStream&&s.addStream(e))}(e),o.push(A())):s.getSenders().forEach(t=>{t.track&&(t.replaceTrack||t.prototype&&t.prototype.replaceTrack||function(t){t.replaceTrack=async function(n){s.removeTrack(t),s.addTrack(n,e);const r=await s.createOffer();r.type=s.localDescription.type,r.sdp=function(e,t){let n=e.match(/a=ssrc-group:FID (\d+) (\d+)\r\n/),r=t.match(/a=ssrc-group:FID (\d+) (\d+)\r\n/);n||(n=e.match(/a=ssrc:(\d+) cname:(.*)\r\n/g)[1].match(/a=ssrc:(\d+)/),r=t.match(/a=ssrc:(\d+) cname:(.*)\r\n/g)[1].match(/a=ssrc:(\d+)/));for(let e=1;e<n.length;e++)t=t.replace(new RegExp(r[e],"g"),n[e]);return t}(s.localDescription.sdp,r.sdp),await s.setLocalDescription(r),await s.setRemoteDescription(s.remoteDescription)}}(t),n&&"audio"===t.track.kind&&o.push(t.replaceTrack(n).catch(e=>{Pt("replace audio track error: %o",e)})),r&&"video"===t.track.kind&&o.push(t.replaceTrack(r).catch(e=>{Pt("replace video track error: %o",e)})))})),await Promise.all(o).finally(async()=>{p=N(),h=!1});try{await a(p)}catch(e){}},adjustBandWidth:async function(e){Pt("adjustBandWidth()");const{audio:t,video:n}=e,r=[];"RTCRtpSender"in window&&"setParameters"in window.RTCRtpSender.prototype?s.getSenders().forEach(e=>{if(e.track)return;const o=e.getParameters();void 0!==t&&"audio"===e.track.kind&&(0===t?delete o.encodings[0].maxBitrate:o.encodings[0].maxBitrate=1024*t,r.push(e.setParameters(o).catch(e=>{Pt("apply audio parameters error: %o",e)}))),void 0!==n&&"video"===e.track.kind&&(0===n?delete o.encodings[0].maxBitrate:o.encodings[0].maxBitrate=1024*n,r.push(e.setParameters(o).catch(e=>{Pt("apply video parameters error: %o",e)})))}):r.push(s.createOffer().then(e=>s.setLocalDescription(e)).then(()=>{const e=Ot(s.remoteDescription.sdp);for(const r of e.media)void 0!==t&&"audio"===r.type&&(r.bandwidth=0===t?[]:[{type:"TIAS",limit:Math.ceil(1024*t)}]),void 0!==n&&"video"===r.type&&(r.bandwidth=0===n?[]:[{type:"TIAS",limit:Math.ceil(1024*n)}]);const r={type:s.remoteDescription.type,sdp:jt(e)};return s.setRemoteDescription(r)}).catch(e=>{Pt("applying bandwidth restriction to setRemoteDescription error: %o",e)})),await Promise.all(r)},applyConstraints:async function(e){Pt("applyConstraints()");const{audio:t,video:n}=e,r=[];s.getSenders&&window.MediaStreamTrack.prototype.applyConstraints&&s.getSenders().forEach(e=>{t&&e.track&&"audio"===e.track.kind&&r.push(e.track.applyConstraints(t).catch(e=>{Pt("apply audio constraints error: %o",e)})),n&&e.track&&"video"===e.track.kind&&r.push(e.track.applyConstraints(n).catch(e=>{Pt("apply video constraints error: %o",e)}))}),await Promise.all(r)},getStats:async function(){if(Pt("getStats()"),"stable"===s.signalingState){let e;e=$t.chrome?await new Promise(e=>{s.getStats(t=>{e(t.result())})}):await s.getStats(),d.update(e)}else Pt("update rtc stats failed since connection is unstable.");return d}})}const zt=u("MN:SDP"),_t=de();const Ht=u("MN:MediaChannel");function Wt(e){const{api:t,type:n="main"}=e;let r,o,a,i,s,c;const u=Bt({invite:async e=>{Ht("invite()");let{sdp:i}=e;a=t.request(e.renegotiate?"main"===n?"renegMedia":"renegShare":"main"===n?"joinMedia":"joinShare").data({sdp:i,"media-version":r});const s=await a.send();return({sdp:i,"media-version":r=r,"mcu-callid":o=o}=s.data.data),Ht("MCU call-id: %s",o),{sdp:i}},confirm:()=>{Ht("confirm()"),a=void 0},cancel:()=>{Ht("cancel()"),a&&a.cancel(),a=void 0,r=void 0},bye:()=>{Ht("bye()"),a=void 0,r=void 0},localstream:e=>{s=e,u.emit("localstream",s)}});return u.on("sdp",e=>{"local"!==e.originator?Ht(`${e.originator} sdp: \n\n %s \n`,e.sdp):function(){let e,t,n,r="main",o=1920,a=1080,i=30,s=!1;return n={content:e=>(r=e,n),width:e=>(o=e,n),height:e=>(a=e,n),frameRate:e=>(i=e,n),highFrameRate:e=>(s=e,n),prefer:t=>(e=t,n),unsupport:e=>(t=e,n),build:function(){return n=>{const{originator:c,type:u}=n,d=Ot(n.sdp),l=a,f=i,p=Math.ceil(o*l/255),m=Math.ceil(f*p);let g=l>=1080?2048:l>=720?1280:512;g=Math.ceil(g*f/30);for(const n of d.media){if("video"===n.type){n.content=r,n.bandwidth=[{type:"TIAS",limit:Math.ceil(1024*g)}];const o=new Set,a=new Set,i=[`max-fr=${f}`,`max-fs=${p}`],d=[`max-mbps=${m}`,`max-fs=${p}`];for(const e of n.rtp){let t;switch(e.codec.toUpperCase()){case"VP8":case"VP9":o.add(Number(e.payload)),t=n.fmtp.find(t=>t.payload===e.payload),t?t.config=t.config.split(";").filter(e=>!(/^max-fr/.test(e)||/^max-fs/.test(e))).concat(i).join(";"):n.fmtp.push({payload:e.payload,config:i.join(";")});break;case"H264":a.add(Number(e.payload)),t=n.fmtp.find(t=>t.payload===e.payload),t?t.config=s&&-1!==t.config.indexOf("profile-level-id=42e01f")&&"local"===c&&"offer"===u?t.config.split(";").filter(e=>!(/^max-mbps/.test(e)||/^max-fs/.test(e)||/^profile-level-id/.test(e))).concat(["profile-level-id=64001f"]).concat(d).join(";"):s&&-1!==t.config.indexOf("profile-level-id=64001f")&&"remote"===c&&"answer"===u?t.config.split(";").filter(e=>!(/^max-mbps/.test(e)||/^max-fs/.test(e)||/^profile-level-id/.test(e))).concat(["profile-level-id=42e01f"]).concat(d).join(";"):t.config.split(";").filter(e=>!(/^max-mbps/.test(e)||/^max-fs/.test(e))).concat(d).join(";"):n.fmtp.push({payload:e.payload,config:d.join(";")})}}for(const e of n.fmtp){const t=e.config.split(";").find(e=>/^apt=/.test(e));if(!t)continue;const n=t.split("=")[1];o.has(Number(n))?o.add(Number(e.payload)):a.has(Number(n))&&a.add(Number(e.payload))}let l="vp8"===e?o:"h264"===e?a:new Set;const h="vp8"===t?o:"h264"===t?a:new Set;if((_t.firefox||_t.chrome&&parseInt(_t.version,10)<63&&"slides"===r)&&(l=o),!l.size||!h.size){let e=String(n.payloads).split(" ");e=e.filter(e=>!l.has(Number(e))),e=e.filter(e=>!h.has(Number(e))),e=Array.from(l).sort((e,t)=>e-t).concat(e),n.rtp=n.rtp.filter(e=>!h.has(Number(e.payload))),n.fmtp=n.fmtp.filter(e=>!h.has(Number(e.payload)));const t=[],r=[];e.forEach(e=>{const o=n.rtp.find(t=>t.payload===Number(e)),a=n.fmtp.find(t=>t.payload===Number(e));o&&t.push(o),a&&r.push(a)}),n.rtp=t,n.fmtp=r,n.payloads=e.join(" ")}}"audio"===n.type&&(n.bandwidth=[{type:"TIAS",limit:Math.ceil(131072)}])}d.media=d.media.filter(e=>"application"!==e.type||/TLS/.test(e.protocol)),"remote"===c&&(d.media.forEach(e=>{const t=String(e.payloads).split(" ");if(e.rtcpFb){const n=[];e.rtcpFb.forEach(e=>{("*"===e.payload||t.includes(`${e.payload}`))&&n.push(e)}),e.rtcpFb=n}if(e.fmtp){const n=[];e.fmtp.forEach(e=>{("*"===e.payload||t.includes(`${e.payload}`))&&n.push(e)}),e.fmtp=n}if(e.rtp){const n=[];e.rtp.forEach(e=>{("*"===e.payload||t.includes(`${e.payload}`))&&n.push(e)}),e.rtp=n}}),"offer"===u&&_t.firefox&&d.media.forEach(e=>{void 0===e.mid&&(e.mid="audio"===e.type?0:"video"===e.type?1:e.mid)})),n.sdp=jt(d),zt(`${c} sdp: \n\n %s \n`,n.sdp)}}}}().content(n).prefer("h264").build()(e)}),u.on("peerconnection",e=>{e.addEventListener("connectionstatechange",()=>{Ht("peerconnection:connectionstatechange : %s",e.connectionState)}),e.addEventListener("iceconnectionstatechange",()=>{Ht("peerconnection:iceconnectionstatechange : %s",e.iceConnectionState)}),e.addEventListener("icegatheringstatechange",()=>{Ht("peerconnection:icegatheringstatechange : %s",e.iceGatheringState)}),e.addEventListener("negotiationneeded",()=>{Ht("peerconnection:negotiationneeded"),u.emit("negotiationneeded")}),e.addEventListener("track",e=>{Ht("peerconnection:track: %o",e),c=e.streams[0],u.emit("remotestream",c)}),e.addEventListener("addstream",e=>{Ht("peerconnection:addstream: %o",e),c=e.stream,u.emit("remotestream",c)}),e.addEventListener("removestream",e=>{Ht("peerconnection:removestream: %o",e),c=u.getRemoteStream(),u.emit("removestream",c)})}),u.on("icecandidate",e=>{const{candidate:t,ready:n}=e;i&&(clearTimeout(i),i=void 0),t&&(i=setTimeout(()=>{Ht("ICE gathering timeout in 3 seconds"),n()},3e3))}),Object.spread({},u,{get status(){return u.status},get connection(){return u.connection},get startTime(){return u.startTime},get endTime(){return u.endTime},get version(){return r},get callId(){return o}})}var Vt;!function(e){e[e.kNull=0]="kNull",e[e.kSending=1]="kSending",e[e.kSuccess=2]="kSuccess",e[e.kFailed=3]="kFailed"}(Vt||(Vt={}));const Jt=u("MN:Message");function Gt(e){const{api:t}=e,n=ze(Jt);let r,o,a,i,s,c=Vt.kNull,u="outgoing",d=e.content,l=e.sender,f=!1;async function p(e){if(Jt("send()"),"incoming"===u)throw new Error("Invalid Status");let d;c=Vt.kSending,n.emit("sending",i),s=t.request("pushMessage").data({"im-context":i.content,"user-entity-list":e});try{d=await s.send()}catch(e){throw c=Vt.kFailed,n.emit("failed",i),e}const{data:l}=d;a=e,({"im-version":o,"im-timestamp":r}=l.data),c=Vt.kSuccess,n.emit("succeeded",i)}return i=Object.spread({},n,{get status(){return c},get direction(){return u},get content(){return d},get timestamp(){return r},get version(){return o},get sender(){return l},get receiver(){return a},get private(){return a&&a.length>0||f},send:p,retry:async function(){if(Jt("retry()"),!d)throw new Error("Invalid Message");await p(a)},cancel:function(){Jt("cancel()"),s&&(s.cancel(),s=void 0)},incoming:function(e){return u="incoming",d=e["im-context"],r=e["im-timestamp"],o=e["im-version"],f=e["is-private"],l={entity:e["sender-entity"],subjectId:e["sender-subject-id"],displayText:e["sender-display-text"]},i}})}const Zt=u("MN:ChatChannel");const Xt=u("MN:Conference"),Kt=ce(),Qt=de();var Yt;function en(e){const{api:t}=e,n=ze(Xt);let r,o,a,i,s,c,u,d,l,f,p,m,g,h,y=Yt.kNull;function w(){return l||(l=a.users.getCurrent(),l&&(n.emit("user",l),l.on("holdChanged",S))),l}function v(e,t){if(y===e)throw new Error(t||"Invalid State")}function b(e,t){if(y!==e)throw new Error(t||"Invalid State")}function k(){Xt("conference connected"),function(){w();const{state:e,users:i}=a;e.on("sharingUserEntityChanged",e=>{n.emit("sharinguser",i.getUser(e),e)}),e.on("speechUserEntityChanged",e=>{n.emit("speechuser",i.getUser(e),e)}),i.on("user:added",(...e)=>n.emit("user:added",...e)),i.on("user:updated",(...e)=>n.emit("user:updated",...e)),i.on("user:deleted",(...e)=>n.emit("user:deleted",...e)),r=He({api:t}),o=Ve({api:t,onInformation:e=>{Xt("receive information: %o",e),a.update(e),n.emit("information",a),w()},onMessage:e=>{Xt("receive message: %o",e),d.incoming(e)},onCallRecord:e=>{Xt("receive callRecord: %o",e),n.emit("callrecord",e)},onRenegotiate:e=>{Xt("receive renegotiate: %o",e),T(c),T(u)},onQuit:e=>{Xt("receive quit: %o",e),y!==Yt.kDisconnecting&&y!==Yt.kDisconnected?C(e):Xt("receive quit while disconnecting, ignore it")},onError:e=>{Xt("polling error: %o",e),y!==Yt.kDisconnecting&&y!==Yt.kDisconnected?"Network Error"!==e.message?(n.emit("error",e),C(e)):Xt("polling error while network error"):Xt("polling error while disconnecting, ignore it")}}),r.start(),o.start(),c=Wt({api:t,type:"main"}),u=Wt({api:t,type:"slides"}),d=function(e){const{api:t,sender:n}=e,r=ze(Zt);let o,a=[],i=!1;return Object.spread({},r,{get ready(){return i},get messages(){return a},connect:async function(e=2e3){if(Zt("connect()"),i)return;o=t.request("pullMessage").data({count:e});const n=await o.send(),{data:s}=n.data;a=s.imInfos.map(e=>Gt({api:t}).incoming(e)),i=!0,r.emit("ready"),r.emit("connected")},terminate:async function(){Zt("terminate()"),a=[],i=!1,o&&(o.cancel(),o=void 0),r.emit("disconnected")},sendMessage:async function(e,o){Zt("sendMessage()");const i=Gt({api:t,content:e,sender:n});return r.emit("message",{originator:"local",message:i}),await i.send(o),a.push(i),i},incoming:function(e){Zt("incoming()");const n=Gt({api:t}).incoming(e);return r.emit("message",{originator:"remote",message:n}),a.push(n),n}})}({api:t}),d.on("message",(...e)=>n.emit("message",...e)),d.on("ready",(...e)=>n.emit("chatready",...e)),S()}(),y=Yt.kConnected,n.emit("connected")}function C(e){Xt("conference disconnected"),function(){r&&r.stop();o&&o.stop();i&&t.interceptors.request.eject(i);c&&c.terminate();u&&u.terminate();d&&d.terminate();g=void 0}(),y=Yt.kDisconnected,n.emit("disconnected",e)}async function S(){d&&(d.ready||await d.connect().catch(()=>{}))}async function T(e){if(y!==Yt.kConnected)return void Xt("retry channel in wrong conference status: %s",y);const{localMediaStream:t,rtcConstraints:n,rtcOfferConstraints:r}=e.getConnectOptions();await e.terminate("Retry"),await e.connect({rtcConstraints:n,rtcOfferConstraints:r,mediaStream:t,mediaConstraints:{audio:!1,video:!1}})}async function E(){switch(v(Yt.kDisconnecting),v(Yt.kDisconnected),y){case Yt.kNull:break;case Yt.kConnecting:case Yt.kConnected:y===Yt.kConnected?(Xt("conference disconnecting"),y=Yt.kDisconnecting,n.emit("disconnecting"),await t.request("leave").send().catch(e=>{Xt("leave error: ",e)}),C()):g&&(g.cancel(),C())}return s}return s=Object.spread({},n,{get api(){return t},get url(){return m},get uuid(){return f},get userId(){return`${p}`},get user(){return l},get information(){return a},get description(){return a&&a.description},get state(){return a&&a.state},get view(){return a&&a.view},get users(){return a&&a.users},get rtmp(){return a&&a.rtmp},get record(){return a&&a.record},get mediaChannel(){return c},get shareChannel(){return u},get chatChannel(){return d},get trtc(){return h},join:async function(e={}){if(Xt("join()"),b(Yt.kNull),!e.url&&!e.number)throw new TypeError("Invalid Number");let r,o;y=Yt.kConnecting,Xt("conference connecting"),y=Yt.kConnecting,n.emit("connecting"),!e.url&&e.number&&(g=t.request("getURL").data({"long-number":e.number}),r=await g.send(),({data:o}=r),({url:e.url}=o.data));const c=le.get("useragent",`Yealink ${Kt?"WECHAT":"WEB-APP"} 1.0.5`),u=le.get("clientinfo",`${Kt?"Apollo_WeChat":"Apollo_WebRTC"} 1.0.5`);g=t.request(Kt?"joinWechat":"joinFocus").data({"conference-url":e.url,"conference-pwd":e.password,"user-agent":c,"client-url":e.url.replace(/\w+@/g,Kt?"wechat@":"webrtc@"),"client-display-text":e.displayName||`${Qt}`,"client-type":"http","client-info":u,"pure-ctrl-channel":!1,"is-webrtc":!Kt&&!0,"is-wechat":Kt,"video-session-info":Kt&&{bitrate:614400,"video-width":640,"video-height":360,"frame-rate":15}});try{r=await g.send()}catch(e){throw n.emit("failed",e),e}if(({data:o}=r),({"conference-user-id":p,"conference-uuid":f}=o.data),h=Kt?o.data:{},Xt("conference accepted"),n.emit("accepted"),!p||!f)throw Xt("internal error"),new Error("Internal Error");({url:m}=e),i=t.interceptors.request.use(e=>(/conference-ctrl/.test(e.url)&&"post"===e.method&&(e.data=Object.spread({},{"conference-user-id":p,"conference-uuid":f},e.data)),e)),g=t.request("getFullInfo");try{r=await g.send()}catch(e){throw n.emit("failed",e),e}({data:o}=r);const d=o.data,l=function(e){return new Proxy({},{get:(t,n)=>n in t?t[n]:Reflect.get(e,n)})}(s);return a=St(d,l),k(),s},leave:E,end:async function(){return b(Yt.kConnected),await Promise.all([E(),t.request("end").data({"conference-url":m}).send()]),s},share:async function(e){b(Yt.kConnected),u.isInProgress()||u.isEstablished()||await u.connect(e),await t.request("switchShare").data({share:!0}).send()},setSharing:async function(e=!0){b(Yt.kConnected),await t.request("switchShare").data({share:e}).send()},sendMessage:async function(e,t){if(b(Yt.kConnected),!d||!d.ready)throw new Error("Not Ready");await d.sendMessage(e,t)}})}!function(e){e[e.kNull=0]="kNull",e[e.kConnecting=1]="kConnecting",e[e.kConnected=2]="kConnected",e[e.kDisconnecting=3]="kDisconnecting",e[e.kDisconnected=4]="kDisconnected"}(Yt||(Yt={}));const tn=u("MN:UA");function nn(e={}){let t,{auth:n}=e;return n&&({api:t}=n),{fetch:async function(e){let n,r,o,a,i;tn("fetch()"),t||(t=Pe()),n=await t.request("getURL").data({"long-number":e}).send(),({data:r}=n),({"party-id":a,url:i}=r.data);try{n=await t.request("getBasicInfo").data({"conference-url":i}).send(),({data:r}=n),o=r.data}catch(a){tn("Conference not started.");try{n=await t.request("getBasicInfoOffline").data({"long-number":e}).send(),({data:r}=n),o=r.data}catch(e){tn("Conference not exist.")}}if(!o)throw new Error("Not Exist");return{partyId:a,number:e,url:i,info:o}},connect:async function(e){let r,o;if(tn("connect()"),t||(t=Pe()),!e.number)throw new TypeError("Invalid Number");const{number:a}=e,i=await t.request("getURL").data({"long-number":a}).send(),{data:s}=i;if(({"party-id":r,url:o}=s.data),!r)throw new TypeError("Invalid Number");let c=!1;n&&n.token||(n=await async function(e){let t;const n=Pe(()=>t);await o();const r=qe({interval:3e5,work:o});async function o(){const r=await n.request("getVirtualJWT").params({id:e}).send();if(({token:t}=r.data.data),!t)throw new Error("Authorization Error")}return r.start(!1),{get token(){return t},api:n,worker:r,invalid:async function(){r.stop(),t=void 0}}}(r),({api:t}=n),c=!0);const u=en({api:t}),{join:d}=u;return u.join=t=>d(Object.spread({},{url:o},e,t)),c&&u.once("disconnected",n.invalid),u}}}"function"!=typeof Object.spread&&Object.defineProperty(Object,"spread",{value:te,writable:!0,configurable:!0});const rn=u("MN");e.adapter=Y,e.axios=J,e.bootstrap=async function(e){const t=Pe(),n=await t.request("login").data({principle:e.principle,credential:we(e.credential),number:e.enterprise,mobileCode:e.areacode,accountType:e.authtype}).send(),{account:r,tokens:o}=n.data.data,a=o.map(e=>{const t=e.token;let n;return Object.spread({},e,{get account(){return r},get auth(){return n},confirm:async()=>(n||(n=await async function(e){let t=e;const n=Pe(()=>t),r=await n.request("selectAccount").send();({token:t}=r.data.data);const o=qe({interval:3e5,work:async()=>{await n.request("refreshToken").send()}});return o.start(!1),{get token(){return t},api:n,worker:o,invalid:async function(){await n.request("logout").send().catch(()=>{}),o.stop(),t=void 0}}}(t)),n)})});return{account:r,identities:a}},e.connect=async function(e){const t=nn();return await t.connect(e)},e.createUA=nn,e.createUserApi=Pe,e.debug=u,e.fetchControlUrl=async function(e,t,n){e.auth||await e.confirm();const{auth:r,party:o}=e,{api:a,token:i}=r,{number:s}=o,c=await a.request("getConferenceInfo").params({conferenceNo:t,searchNotStartedScheduledConference:!1}).send(),{conferenceNo:u,domain:d,vmr:l,scheduledConference:f}=c.data.data,p=u.split(".")[1];let m="",g=1;l&&({vmrId:m}=l),f&&({planId:m,sequence:g}=f);const h=G,y=["source=WEBUSER",`conference=${h(`${p}@${d}`)}`,`sequence=${g}`,`id=${m}`,`client=${h(`${s}@${d}`)}`,`t=${h(i)}`];return`${n=(n=n||a.delegate.defaults.baseURL).replace("webapp","control")}?${y.join("&")}`},e.setup=function(e){fe(e),ce()&&(J.defaults.adapter=Y),u.enable(le.get("debug","MN*,-MN:Api*,-MN:Information:Item,-MN:Worker")),rn("setup() [version]: %s","1.0.5")},e.version="1.0.5",Object.defineProperty(e,"__esModule",{value:!0})}));
