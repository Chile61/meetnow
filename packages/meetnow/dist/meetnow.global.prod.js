var MeetNow=function(e,t,n){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t,n=n&&n.hasOwnProperty("default")?n.default:n;const r=/version\/(\d+(\.?_?\d+)+)/i;function a(e,t){const n=t.match(e);return n&&n.length>0&&n[1]||""}function o(e,t){const n=t.match(e);return n&&n.length>1&&n[2]||""}function i(e,t){return{name:e,version:t,firefox:"firefox"===e,chrome:"chrome"===e||"chromium"===e,wechet:"wechat"===e,toString:()=>`${e.toUpperCase()} ${t}`}}const s=[{test:[/micromessenger/i],describe:e=>i("wechat",a(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,e)||a(r,e))},{test:[/\sedg\//i],describe:e=>i("edge",a(/\sedg\/(\d+(\.?_?\d+)+)/i,e))},{test:[/edg([ea]|ios)/i],describe:e=>i("edge",o(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,e))},{test:[/firefox|iceweasel|fxios/i],describe:e=>i("firefox",a(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,e))},{test:[/chromium/i],describe:e=>i("chromium",a(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,e)||a(r,e))},{test:[/chrome|crios|crmo/i],describe:e=>i("chrome",a(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,e))},{test:[/safari|applewebkit/i],describe:e=>i("safari",a(r,e))},{test:[/.*/i],describe(e){const t=-1!==e.search("\\(")?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return i(a(t,e),o(t,e))}}],c={};function d(e){if(!c.browser){e=e||navigator.userAgent;const t=s.find(t=>t.test.some(t=>t.test(e)));t&&(c.browser=t.describe(e))}return c.browser}function u(){return d()}d();function l(){return/miniprogram/i.test(navigator.userAgent)||window&&"miniprogram"===window.__wxjs_environment}l();const m=new class{constructor(){this.m=new Map}reset(e){this.m=new Map(Object.entries(e))}get(e,t){const n=this.m.get(e);return void 0!==n?n:t}getBoolean(e,t=!1){const n=this.m.get(e);return void 0===n?t:"string"==typeof n?"true"===n:!!n}getNumber(e,t){const n=parseFloat(this.m.get(e));return Number.isNaN(n)?void 0!==t?t:NaN:n}set(e,t){this.m.set(e,t)}},p=e=>{try{const t=e.sessionStorage.getItem("meetnow-persist-config");return null!==t?JSON.parse(t):{}}catch(e){return{}}},f=e=>{const t={};return e.location.search.slice(1).split("&").map(e=>e.split("=")).map(([e,t])=>[decodeURIComponent(e),decodeURIComponent(t)]).filter(([e])=>{return t="meetnow:",e.substr(0,t.length)===t;var t}).map(([e,t])=>[e.slice("meetnow:".length),t]).forEach(([e,n])=>{t[e]=n}),t};function g(){const e=window,t=e.MeetNow=e.MeetNow||{},n={...p(e),persistent:!1,...t.config,...f(e)};m.reset(n),m.getBoolean("persistent")&&((e,t)=>{try{e.sessionStorage.setItem("meetnow-persist-config",JSON.stringify(t))}catch(e){return}})(e,n),t.config=m,m.getBoolean("testing")&&m.set("debug","MN:*")}const h="post",y="/conference-ctrl/api/v1/ctrl/",w={getVirtualJWT:{method:"get",url:`${"/user-manager/api/v1/"}external/virtualJwt/party`},getURL:{method:h,url:`${y}get-url-by-long-num`},getFullInfo:{method:h,url:`${y}get-conference-info`},getBasicInfo:{method:h,url:`${y}get-short-info`},getBasicInfoOffline:{method:h,url:`${y}get-short-info-offline`},getStats:{method:h,url:`${y}get-call-stats`},polling:{method:h,url:`${y}polling`},keepalive:{method:h,url:`${y}user-keepalive`},joinFocus:{method:h,url:`${y}join-focus`},joinWechat:{method:h,url:`${y}join-wechat`},joinMedia:{method:h,url:`${y}join-audio-video`},renegMedia:{method:h,url:`${y}av-reneg`},joinShare:{method:h,url:`${y}join-applicationsharing-v2`},leaveShare:{method:h,url:`${y}bye-applicationsharing`},switchShare:{method:h,url:`${y}applicationsharing-switch`},renegShare:{method:h,url:`${y}applicationsharing-reneg`},pushMessage:{method:h,url:`${y}im-info`},pullMessage:{method:h,url:`${y}get-all-im-info`},muteAll:{method:h,url:`${y}mute-all`},unmuteAll:{method:h,url:`${y}unmute-all`},acceptLobbyUser:{method:h,url:`${y}grant-lobby-user`},acceptLobbyUserAll:{method:h,url:`${y}grant-lobby-all`},rejectLobbyUserAll:{method:h,url:`${y}del-lobby-all`},waitLobbyUser:{method:h,url:`${y}wait-lobby-user`},waitLobbyUserAll:{method:h,url:`${y}wait-lobby-all`},rejectHandupAll:{method:h,url:`${y}reject-all-hand-up`},deleteUser:{method:h,url:`${y}delete-user`},setUserMedia:{method:h,url:`${y}modify-user-media`},setUserRole:{method:h,url:`${y}modify-user-role`},setUserDisplayText:{method:h,url:`${y}edit-user-display-text`},holdUser:{method:h,url:`${y}wait-lobby-user`},inviteUser:{method:h,url:`${y}invite-user`},setFocusVideo:{method:h,url:`${y}set-focus-video`},setSpeakMode:{method:h,url:`${y}set-speak-mode`},setFreeLayout:{method:h,url:`${y}set-free-layout`},setCustomizeLayout:{method:h,url:`${y}set-customize-layout`},setGlobalLayout:{method:h,url:`${y}set-global-layout`},setFecc:{method:h,url:`${y}set-fecc`},setTitle:{method:h,url:`${y}set-title`},sendTitle:{method:h,url:`${y}send-title`},setRecord:{method:h,url:`${y}record-operate`},setRTMP:{method:h,url:`${y}rtmp-operate`},setLock:{method:h,url:`${y}lock-conference`},leave:{method:h,url:`${y}quit-conference`},end:{method:h,url:`${y}end-conference`}},k={msg:"Unknown Error",errorCode:-1};class v extends Error{constructor(e,t=k){super(),this.name="ApiError",this.message=t.msg,this.errCode=t.errorCode,this.bizCode=e}}const b=t("MN:Api:Request"),{isCancel:S}=n;const T=t("MN:Api");function E(e={}){T("createApi()");const t=n.create({baseURL:"/",timeout:3e4,...e});return t.interceptors.response.use(e=>{const{ret:t,bizCode:n,error:r,data:a}=e.data;if(t<0)throw new v(n,r);if(0===t&&r)throw new v(n,r);return T("request success: %o",a),e},e=>{throw T("request error: %o",e),e}),{get interceptors(){return t.interceptors},request:function(e){return T(`request() "${e}"`),function(e,t=n){let r,a;return a={config:e,header:function(t){return e.headers=t,a},params:function(t){return e.params=t,a},data:function(t){return e.data=t,a},send:function(){return b("send()"),r=n.CancelToken.source(),e.cancelToken=r.token,t(e)},cancel:function(e="canceled"){return b("cancel()"),r&&r.cancel(e)}}}({...w[e]},t)}}}const R=e=>null!=e,{isArray:C}=Array,{hasOwnProperty:M}=Object.prototype,A=(e,t)=>M.call(e,t),N=/-(\w)/g,U=e=>e.replace(N,(e,t)=>t?t.toUpperCase():""),I=t("MN:Worker");function L(e){let t,n=!1,r=!1,a=0,o=0;const{interval:i=a,work:s,cancel:c}=e;async function d(e=!0){(s&&e&&(r=!0,await s(o++),r=!1),n)&&(a="function"==typeof i?i():i,t=setTimeout(d,a))}return{config:e,get running(){return n},start:async function(e=!0){I("start()"),n||(n=!0,await d(e))},stop:function(){I("stop()"),n&&(t&&(clearTimeout(t),t=void 0),r&&c&&c(),n=!1)}}}const x=t("MN:Events");function P(e=x){let t;const n={};function r(e,t){C(e)?e.forEach(e=>r(e,t)):(n[e]||(n[e]=[])).push(t)}function a(e,t){if(C(e))return void e.forEach(e=>a(e,t));const r=n[e];if(!r)return;if(!t)return void(n[e]=null);let o,i=r.length;for(;i--;)if(o=r[i],o===t||o.fn===t){r.splice(i,1);break}}return t={on:(e,n)=>(r(e,n),t),off:(e,n)=>(a(e,n),t),once:(e,n)=>(function(e,t){function n(...r){a(e,n),t.apply(this,r)}n.fn=t,r(e,n)}(e,n),t),emit:(r,...a)=>(function(t,...r){e(`emit() "${t}"`);const a=n[t];if(a)for(const e of a)try{e(...r)}catch(e){}}(r,...a),t)}}const $=t("MN:Keepalive");function F(e){const{api:t}=e;let n,r=!1,a=e.interval||3e4,o=0;async function i(){let i,s;$("keepalive()");try{r=!1,n=t.request("keepalive"),i=await n.send()}catch(t){if(s=t,r=S(t),r)return;o++,a=function(e){$(`computeNextTimeout() attempts: ${e}`);let t=Math.floor(Math.random()*Math.pow(2,e)+1);return t<2&&(t=2),t>30&&(t=30),1e3*t}(o),$("keepalive error: %o",s),e.onError&&e.onError(s,o)}if(o>15&&e.onError&&e.onError(new Error("Max Attempts"),o),s)return;const{bizCode:c,data:d={interval:a}}=i.data,{interval:u}=d;a=Math.min(1e3*u,a)}return{...L({work:()=>i(),interval:()=>a,cancel:()=>n.cancel()}),keepalive:i}}const O=t("MN:Polling");function D(e){const{api:t}=e;let n,r=100,a=0,o=0;function i(t){if(!t)return;const{version:n,category:r,body:a}=t;if(!R(n)||n<=o)O(`illegal version: ${n}, current version: ${o}.`);else{switch(r){case"conference-info":e.onInformation&&e.onInformation(a);break;case"im-record":e.onMessage&&e.onMessage(a);break;case"port-change":e.onRenegotiate&&e.onRenegotiate(a);break;case"quit-conference":e.onQuit&&e.onQuit(a);break;default:O(`unsupported category: ${r}`)}o=n}}async function s(){let s,c;O("poll()");let d=!1,u=!1;try{n=t.request("polling").data({version:o}),s=await n.send()}catch(t){if(c=t,d=S(t),d)return;if(u=!!c&&[900408,901323].includes(c.bizCode),u)return;a++,r=function(e){O(`computeNextTimeout() attempts: ${e}`);let t=Math.floor(Math.random()*Math.pow(2,e)+1);return t<2&&(t=2),t>30&&(t=30),1e3*t}(a),O("polling error: %o",c),e.onError&&e.onError(c,a)}if(a>15&&e.onError&&e.onError(new Error("Max Attempts"),a),c)return;const{bizCode:l,data:m}=s.data;try{i(m)}catch(c){O("process data failed. %o",c)}a=0}return{...L({work:()=>s(),interval:()=>r,cancel:()=>n.cancel()}),poll:s,analyze:i}}const q=t("MN:Reactive");function j(e={},t){return t=t||P(q),new Proxy(e,{set(e,n,r,a){const o=e[n],i=A(e,n),s=Reflect.set(e,n,r,a);return i||t.emit(`${U(n)}Added`,r),((e,t)=>e!==t&&(e==e||t==t))(r,o)&&t.emit(`${U(n)}Changed`,r,o),s}})}const B=t("MN:Information:Description");const z=t("MN:Information:State");const V=t("MN:Information:Layout");const _=t("MN:Information:Danmaku"),H={position:"top",type:"static",displayTime:30,repeatCount:2,repeatInterval:5,rollDirection:"R2L"};const W=t("MN:Information:View");function G(e,t){const{api:n}=t,r=P(W),a=j(c({}),r),o=function(e){async function t(t){V("setCustomizeLayout()"),t.viewer=t.viewer||"attendee",await e.request("setCustomizeLayout").data(t).send()}return{setLayout:async function(t){V("setLayout()"),await e.request("setFreeLayout").data(t).send()},setCustomizeLayout:t,setPresenterLayout:async function(e){V("setPresenterLayout()"),e.viewer="presenter",await t(e)},setAttendeeLayout:async function(e){V("setAttendeeLayout()"),e.viewer="attendee",await t(e)},setCastViewerLayout:async function(e){V("setCastViewerLayout()"),e.viewer="castviewer",await t(e)},setOSD:async function(t={name:!0,icon:!0}){V("setOSD()");const{name:n,icon:r}=t;await e.request("setGlobalLayout").data({"hide-osd-site-icon":r,"hide-osd-site-name":n}).send()},setSpeakMode:async function(t){V("setSpeakMode()"),await e.request("setSpeakMode").data({"speak-mode":t}).send()}}}(n),i=function(e){let t=H;return{setDanmaku:async function(n){_("setDanmaku()");const r={...t,config:n},{type:a,position:o,displayTime:i,repeatCount:s,repeatInterval:c,rollDirection:d}=r;await e.request("setTitle").data({type:a,position:o,"display-time":i,"repeat-count":s,"repeat-interval":c,"roll-direction":d}).send(),t=r},sendDanmaku:async function(t,n){_("sendDanmaku()");const{attendee:r=!0,castviewer:a=!0,presenter:o=!0}=n||{};await e.request("sendTitle").data({"display-text":t,"all-attendee":r,"all-castviewer":a,"all-presenter":o})}}}(n);let s;function c(e){return e.focusUserEntity=l(),e}function d(){return e["entity-view"].find(e=>"audio-video"===e.entity)}function u(){return d()["entity-state"]}function l(){return u()["focus-video-user-entity"]}return s={...r,get data(){return e},get:t=>e[t],...o,...i,update:function(e){c(a),r.emit("updated",s)},getVideoView:d,getLayout:u,getFocusUserEntity:l,getDanmaku:function(){return d().title}}}const Z=t("MN:Information:Camera");var J;!function(e){e.LEFT="PanLeft",e.RIGHT="PanRight",e.DOWN="TiltDown",e.UP="TiltUp",e.ZOOMOUT="ZoomOut",e.ZOOMIN="ZoomIn",e.FOCUSOUT="FocusOut",e.FOCUSIN="FocusIn"}(J||(J={}));const Q=t("MN:Information:User");function K(e,t){const{api:n,userId:r}=t,a=P(Q),o=j(d({}),a),i=u(),s=function(e,t){async function n(n){Z("action()"),await e.request("setFecc").data({"user-entity":t,action:n}).send()}return{action:n,left:function(){return Z("left()"),n(J.LEFT)},right:function(){return Z("right()"),n(J.RIGHT)},down:function(){return Z("down()"),n(J.DOWN)},up:function(){return Z("up()"),n(J.UP)},zoomout:function(){return Z("zoomout()"),n(J.ZOOMOUT)},zoomin:function(){return Z("zoomin()"),n(J.ZOOMIN)},focusout:function(){return Z("focusout()"),n(J.FOCUSOUT)},focusin:function(){return Z("focusin()"),n(J.FOCUSIN)}}}(n,i);let c;function d(t){return t.displayText=e["display-text"],t.role=l(),t.hold=p(),t.handup=b(),t.audio=!k(),t.video=!v(),t.media=f(),t.sharing=S(),t}function u(){return e.entity}function l(){return e.roles&&e.roles.role}function m(t){return e.endpoint.find(e=>e["session-type"]===t)}function p(){const e=m("audio-video");return e&&"on-hold"===e.status}function f(){return!!m("audio-video")}function g(t){return e.endpoint.reduce((e,t)=>e.concat(t.media||[]),[]).find(e=>e.label===t)}function h(e){const t=g(e),{"media-ingress-filter":n={type:"block"},"media-egress-filter":r={type:"block"}}=t||{};return{ingress:n.type,egress:r.type}}function y(){return h("main-audio")}function w(){return h("main-video")}function k(){const{ingress:e}=y();return"block"===e}function v(){const{ingress:e}=w();return"block"===e}function b(){const{ingress:e}=y();return"unblocking"===e}function S(){const e=g("applicationsharing");return e&&"sendonly"===e.status}async function T(e){Q("setFilter()");const{label:t,enable:r}=e,a=c.getEndpoint("audio-video"),o=c.getMedia(t);await n.request("setUserMedia").data({"user-entity":i,"endpoint-entity":a.entity,"media-id":o.id,"media-ingress-filter":r?"unblock":"block"}).send()}async function E(e){Q("setAudioFilter()"),await T({label:"main-audio",enable:e})}return c={...a,get data(){return e},get:t=>e[t],update:function(e){d(o),a.emit("updated",c)},getEntity:u,getUID:function(){return e["subject-id"]},getDisplayText:function(){return e["display-text"]},getRole:l,isCurrent:function(){return i===r},isAttendee:function(){return"attendee"===l()},isPresenter:function(){return"presenter"===l()},isCastviewer:function(){return"castviewer"===l()},isOrganizer:function(){return"organizer"===l()},getEndpoint:m,isOnHold:p,hasFocus:function(){return!!m("focus")},hasMedia:f,hasSharing:function(){return!!m("applicationsharing")},hasFECC:function(){return!!m("fecc")},getMedia:g,getAudioFilter:y,getVideoFilter:w,isAudioBlocked:k,isVideoBlocked:v,isHandup:b,isSharing:S,isSIP:function(){return"sip"===e.protocol.toLowerCase()},isHTTP:function(){return"http"===e.protocol.toLowerCase()},isRTMP:function(){return"rtmp"===e.protocol.toLowerCase()},setFilter:T,setAudioFilter:E,setVideoFilter:async function(e){Q("setVideoFilter()"),await T({label:"main-video",enable:e})},setDisplayText:async function(e){Q("setDisplayText()"),await n.request("setUserDisplayText").data({"user-entity":i,"display-text":e}).send()},setRole:async function(e){Q("setRole()"),await n.request("setUserRole").data({"user-entity":i,role:e}).send()},setFocus:async function(e=!0){Q("setFocus()"),await n.request("setFocusVideo").data({"user-entity":e?i:""}).send()},getStats:async function(){Q("getStats()"),await n.request("getStats").data({"user-entity-list":[i]}).send()},kick:async function(){Q("kick()"),await n.request("deleteUser").data({"user-entity":i}).send()},hold:async function(){Q("hold()"),await n.request("waitLobbyUser").data({"user-entity":i}).send()},unhold:async function(){Q("unhold()"),await n.request("acceptLobbyUser").data({"user-entity":i}).send()},allow:async function(){Q("allow()"),await n.request("acceptLobbyUser").data({"user-entity":i}).send()},accept:async function(){Q("accept()"),await E(!0)},reject:async function(){Q("reject()"),await E(!1)},sendMessage:async function(e){Q("sendMessage()");const{chatChannel:n}=t;n&&n.ready&&await n.sendMessage(e,[i])},camera:s}}const Y=t("MN:Information:Lobby");const X=t("MN:Information:Users");function ee(e,t){const{api:n}=t,r=P(X),a=new Map,o=j(d({}),r),i=function(e){async function t(t){Y("unhold()");const n=t?"acceptLobbyUser":"acceptLobbyUserAll";await e.request(n).data({"user-entity":t}).send()}return{remove:async function(t){Y("remove()");const n=t?"deleteUser":"rejectLobbyUserAll";await e.request(n).data({"user-entity":t}).send()},unhold:t,hold:async function(t){Y("hold()");const n=t?"waitLobbyUser":"waitLobbyUserAll";await e.request(n).data({"user-entity":t}).send()},allow:async function(e){Y("allow()"),await t(e)}}}(n);let s,c;function d(n){return s=e.user.map(e=>{const{entity:n}=e;let r=a.get(n);return r||(r=K(e,t),a.set(n,r)),r}),n}function u(e){return a.has(e)}return c={...r,get data(){return e},get:t=>e[t],...i,update:function(e){const t=[],n=[],i=[];e&&e.user.forEach(e=>{const{entity:r,state:a}=e;u(r)?"deleted"===a?i.push(e):n.push(e):t.push(e)}),d(o),t.forEach(e=>{const{entity:t}=e,n=a.get(t);X("added user:\n\n %s(%s) \n",n.getDisplayText(),n.getEntity()),c.emit("user:added",n)}),n.forEach(e=>{const{entity:t}=e,n=a.get(t);n.update(e),X("updated user:\n\n %s(%s)  \n",n.getDisplayText(),n.getEntity()),c.emit("user:updated",n)}),i.forEach(e=>{const{entity:t}=e,n=a.get(t);X("deleted user:\n\n %s(%s)  \n",n.getDisplayText(),n.getEntity()),c.emit("user:deleted",n),a.delete(t)}),r.emit("updated",c)},getUserList:function(e){return e?s.filter(e):s},getUser:function(e){return a.get(e)},hasUser:u,getCurrent:function(){return s.find(e=>e.isCurrent())},getAttendee:function(){return s.filter(e=>e.isAttendee())},getPresenter:function(){return s.filter(e=>e.isPresenter())},getCastviewer:function(){return s.filter(e=>e.isCastviewer())},getOrganizer:function(){return s.filter(e=>e.isOrganizer())},getOnhold:function(){return s.filter(e=>e.isOnHold())},getHandup:function(){return s.filter(e=>e.isHandup())},getSharing:function(){return s.filter(e=>e.isSharing())},getAudioBlocked:function(){return s.filter(e=>e.isAudioBlocked())},getVideoBlocked:function(){return s.filter(e=>e.isVideoBlocked())},getSIP:function(){return s.filter(e=>e.isSIP())},getHTTP:function(){return s.filter(e=>e.isHTTP())},getRTMP:function(){return s.filter(e=>e.isRTMP())},invite:async function(e){X("invite"),await n.request("inviteUser").data({uid:e.uid,"sip-url":e.sipURL,"h323-url":e.h323URL})},kick:async function(e){X("kick"),await n.request("deleteUser").data({"user-entity":e}).send()},mute:async function(){X("mute"),await n.request("muteAll").send()},unmute:async function(){X("unmute"),await n.request("unmuteAll").send()}}}const te=t("MN:Information:RTMP");var ne;!function(e){e.START="start",e.STOP="stop",e.PAUSE="pause",e.RESUME="resume"}(ne||(ne={}));const re=t("MN:Information:RTMP");function ae(e,t){const{api:n}=t,r=P(re),a=j(s({}),r),o=function(e){async function t(t){te("operation"),await e.request("setRTMP").data({operate:t}).send()}return{operation:t,start:function(){return te("start"),t(ne.START)},stop:function(){return te("stop"),t(ne.STOP)},pause:function(){return te("pause"),t(ne.PAUSE)},resume:function(){return te("resume"),t(ne.RESUME)}}}(n);let i;function s(t){return t.enable=e["rtmp-enable"],t.status=d(),t}function c(t){return t?e.users.find(e=>e.entity===t):e.users.find(e=>e.default)||e.users[0]}function d(e){return c(e)["rtmp-status"]}return i={...r,get data(){return e},get:t=>e[t],update:function(e){s(a),r.emit("updated",i)},getStatus:d,getReason:function(e){return c(e).reason},getDetail:function(e){const t=c(e),{"rtmp-status":n,"rtmp-last-start-time":r,"rtmp-last-stop-duration":a,reason:o}=t;return{reason:o,status:n,lastStartTime:r,lastStopDuration:a}},...o}}const oe=t("MN:Information:Record");var ie;!function(e){e.START="start",e.STOP="stop",e.PAUSE="pause",e.RESUME="resume"}(ie||(ie={}));const se=t("MN:Information:Record");function ce(e,t){const{api:n}=t,r=P(se),a=j(s({}),r),o=function(e){async function t(t){await e.request("setRecord").data({operate:t}).send()}return{operation:t,start:function(){return oe("start()"),t(ie.START)},stop:function(){return oe("stop()"),t(ie.STOP)},pause:function(){return oe("pause()"),t(ie.PAUSE)},resume:function(){return oe("resume()"),t(ie.RESUME)}}}(n);let i;function s(e){return e.status=d(),e}function c(){return e.user}function d(){return c()["record-status"]}return i={...r,get data(){return e},get:t=>e[t],update:function(e){s(a),r.emit("updated",i)},getStatus:d,getReason:function(){return c().reason},getDetail:function(){const e=c(),{"record-status":t,"record-last-start-time":n,"record-last-stop-duration":r,reason:a}=e;return{reason:a,status:t,lastStartTime:n,lastStopDuration:r}},...o}}const de=t("MN:Information:Item");function ue(e){return R(e)&&(null!==(t=e)&&"object"==typeof t)&&!C(e);var t}function le(e){return ue(e)&&A(e,"state")}function me(e,t){de("mergelist()");for(const n of t){le(n)||(de("we don not know how to process a non-partialable item in a list, because it is undocumented"),de("treat it as full state item"));const{id:t,entity:r,state:a="full"}=n,o=r||t;if(!o){de("missing item identity(entity or id).");continue}const i=e.findIndex(e=>e.entity===o||e.id===o);if(de("item identity: %o",o),-1===i){if("deleted"===a){de("can not delete item not exist.");continue}de("item added"),e.push(n);break}if("full"===a){e.splice(i,1,n);break}if("deleted"===a){de("item deleted"),e.splice(i,1);break}pe(e[i],n)}return e}function pe(e,t){if(de("merge()"),e===t)return e;if(!le(t))return t;const{state:n}=t;if("full"===n)return t;if("deleted"===n)return null;"partial"!==n&&(de(`Error: unknown item state. ${n}`),de('use merge policy as "partial"'));for(const n in t)if(A(t,n)){const r=t[n],a=e[n];de("item key: %s value: %o -> %o",n,a,r),e[n]=C(r)?me(a,r):ue(r)?pe(a,r):r}return e}const fe=t("MN:Information");function ge(e,t){const n=P(fe),{api:r}=t,{"conference-description":a,"conference-state":o,"conference-view":i,users:s,"rtmp-state":c,"record-users":d}=e,u=function(e,t){const{api:n}=t,r=P(B),a=j(i({}),r);let o;function i(e){return e.locked=d(),e}function s(){return{admissionPolicy:e["admission-policy"],attendeeByPass:e["attendee-by-pass"]}}async function c(e){B("setLock()");const{admissionPolicy:t,attendeeByPass:r=!0}=e;await n.request("setLock").data({"admission-policy":t,"attendee-lobby-bypass":r}).send()}function d(){return"anonymous"!==s().admissionPolicy}return o={...r,get data(){return e},get subject(){return e.subject},get:t=>e[t],update:function(e){i(a),r.emit("updated",o)},getLock:s,setLock:c,lock:async function(e=!1,t=!0){B("lock()"),await c({admissionPolicy:t?"closedAuthenticated":"openAuthenticated",attendeeByPass:e})},unlock:async function(){B("unlock()"),await c({admissionPolicy:"anonymous"})},isLocked:d}}(a,t),l=function(e,t){const n=P(z),r=j(o({}),n);let a;function o(t){const{active:n,locked:r,applicationsharer:a,"speech-user-entity":o}=e;return t.active=n,t.locked=r,t.sharingUserEntity=a.user&&a.user.entity,t.speechUserEntity=o,t}return a={...n,get data(){return e},get:t=>e[t],update:function(e){o(r),n.emit("updated",a)}}}(o),m=G(i,t),p=ee(s,t),f=ae(c,t),g=ce(d,t);let h;return h={...n,get data(){return e},get version(){return e&&e.version},get:t=>e[t],get description(){return u},get state(){return l},get view(){return m},get users(){return p},get rtmp(){return f},get record(){return g},update:function t(a){fe("update()");const{version:o}=e,{version:i,state:s}=a;if(i){if(!(i<=o))return i-o>1?(fe("information version jumped."),void r.request("getFullInfo").send().then(e=>t(e.data.data)).catch(e=>fe("get full information failed: %o",e))):void("deleted"!==s?("full"===s?Object.assign(e,a):pe(e,a),[{key:"conference-description",part:u},{key:"conference-state",part:l},{key:"conference-view",part:m},{key:"users",part:p},{key:"rtmp-state",part:f},{key:"record-users",part:g}].forEach(e=>{const{key:t,part:n}=e;A(a,t)&&n.update(a[t])}),n.emit("updated",h)):fe("can not delete root information."));fe("receive information with invalid version.")}else fe("receive information without version.")}}}const he={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w\/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-\.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:e=>e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:e=>null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%d trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:e=>null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))? (\S*)(?: (\S*))?/,names:["value","direction","uri","config"],format:e=>`extmap:%d${e.direction?"/%s":"%v"} %s${e.config?" %s":""}`},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:e=>null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format(e){let t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v",t}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format(e){let t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_\/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:e=>null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{name:"content",reg:/^content:([^\s]*)/,format:"content:%s"},{name:"label",reg:/^label:([\d]*)/,format:"label:%d"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:e=>e.params?"rid:%s %s %s":"rid:%s %s"},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:e=>`imageattr:%s %s %s${e.dir2?" %s %s":""}`},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:e=>`simulcast:%s %s${e.dir2?" %s %s":""}`},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{push:"invalid",names:["value"]}]};function ye(e){return String(Number(e))===e?Number(e):e}function we(e,t,n){const r=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:r&&!t[e.name]&&(t[e.name]={});const a=e.push?{}:r?t[e.name]:t;!function(e,t,n,r){if(r&&!n)t[r]=ye(e[1]);else for(let r=0;r<n.length;r+=1)null!=e[r+1]&&(t[n[r]]=ye(e[r+1]))}(n.match(e.reg),a,e.names,e.name),e.push&&t[e.push].push(a)}Object.keys(he).forEach(e=>{he[e].forEach(e=>{e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")})});const ke=RegExp.prototype.test.bind(/^([a-z])=(.*)/);function ve(e){const t=[],n={media:t};let r=n;return e.split(/(\r\n|\r|\n)/).filter(ke).forEach(e=>{const n=e[0],a=e.slice(2);"m"===n&&(t.push({rtp:[],fmtp:[]}),r=t[t.length-1]);for(let e=0;e<(he[n]||[]).length;e+=1){const t=he[n][e];if(t.reg.test(a))return void we(t,r,a)}}),n.media=t,n}function be(e,t){const n=t.split(/=(.+)/,2);return 2===n.length&&(e[n[0]]=ye(n[1])),e}function Se(e){return e.split(/\;\s?/).reduce(be,{})}const Te=Se;const Ee=/%[sdv%]/g,Re=function(e,t,n){const r=`${e}=${t.format instanceof Function?t.format(t.push?n:n[t.name]):t.format}`,a=[];if(t.names)for(let e=0;e<t.names.length;e+=1){const r=t.names[e];t.name?a.push(n[t.name][r]):a.push(n[t.names[e]])}else a.push(n[t.name]);return function(e,...t){let n=0;const r=t.length;return e.replace(Ee,e=>{if(n>=r)return e;const a=t[n];switch(n+=1,e){case"%%":return"%";case"%s":return String(a);case"%d":return Number(a);case"%v":return"";default:return a}})}(r,...a)},Ce=["v","o","s","i","u","e","p","c","b","t","r","z","a"],Me=["i","c","b","a"];function Ae(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach(e=>{null==e.payloads&&(e.payloads="")});const n=t.outerOrder||Ce,r=t.innerOrder||Me,a=[];return n.forEach(t=>{he[t].forEach(n=>{n.name in e&&null!=e[n.name]?a.push(Re(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach(e=>{a.push(Re(t,n,e))})})}),e.media.forEach(e=>{a.push(Re("m",he.m[0],e)),r.forEach(t=>{he[t].forEach(n=>{n.name in e&&null!=e[n.name]?a.push(Re(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach(e=>{a.push(Re(t,n,e))})})})}),`${a.join("\r\n")}\r\n`}function Ne(e){if(e)try{e.getTracks?e.getTracks().forEach(e=>e.stop()):(e.getAudioTracks().forEach(e=>e.stop()),e.getVideoTracks().forEach(e=>e.stop()))}catch(t){"function"!=typeof e.stop&&"object"!=typeof e.stop||e.stop()}}async function Ue(e){let t;if(!navigator.mediaDevices.getUserMedia)throw new Error("Not Supported");return t=await navigator.mediaDevices.getUserMedia(e),function(e){return e.close=e.stop=function(){Ne(this)},e.pause=function(){this.getTracks().forEach(e=>e.enabled=!1)},e.play=function(){this.getTracks().forEach(e=>e.enabled=!0)},e.muteAudio=function(e=!0){this.getAudioTracks().forEach(t=>t.enabled=!e)},e.muteVideo=function(e=!0){this.getVideoTracks().forEach(t=>t.enabled=!e)},e}(t)}function Ie(){let e=-1,t={},n={},r=[];function a(e,t){const n=e.get(t.codecId),r=e.get(t.trackId),a=e.get(t.transportId),o=e.get(t.remoteId);if(n&&(n.name=n.mimeType.split("/")[1]),!t.codecId||!t.trackId||t.transportId,a){const t=e.get(a.localCertificateId),n=e.get(a.remoteCertificateId),r=e.get(a.selectedCandidatePairId);a.localCertificate=t,a.remoteCertificate=n,a.selectedCandidatePair=r}return o&&(t.packetsLost=o.packetsLost||t.packetsLost),t.codec=n,t.track=r,t.transport=a,t}function o(e,t){if(!e)return;const n=e[t][e.mediaType],r=(e={},t={},n)=>void 0!==e[n]&&void 0!==t[n]?Math.abs(e[n]-t[n]):0,a=e=>Number.isFinite(e)?Number.isNaN(e)?0:e:0;if(n){if(!n.trackId||Boolean(e.trackId)){const o=r(e,n,"timestamp");let s;if("outbound"===t&&!e.packetsLostRate){const n=i()[t][e.mediaType],o=r(e,n,"packetsLost"),s=o+r(e,n,"packetsSent");e.packetsLostRate=0===s?0:a(o/s),e.packetsLostRate*=100}if("inbound"===t&&!e.packetsLostRate){const n=i()[t][e.mediaType],o=r(e,n,"packetsLost"),s=o+r(e,n,"packetsReceived");e.packetsLostRate=0===s?0:a(o/s),e.packetsLostRate*=100}"outbound"!==t||e.outgoingBitrate||(s=r(e,n,"bytesSent"),e.outgoingBitrate=a(8*s/o)),"inbound"!==t||e.incomingBitrate||(s=r(e,n,"bytesReceived"),e.incomingBitrate=a(8*s/o)),e.transport&&n.transport&&!e.transport.outgoingBitrate&&(s=r(e.transport,n.transport,"bytesSent"),e.transport.outgoingBitrate=a(8*s/o)),e.transport&&n.transport&&!e.transport.incomingBitrate&&(s=r(e.transport,n.transport,"bytesReceived"),e.transport.incomingBitrate=a(8*s/o)),"video"===e.mediaType&&e.track&&n.track&&!e.track.frameRate&&("inbound"===t&&(s=r(e.track,n.track,"framesReceived")),"outbound"===t&&(s=r(e.track,n.track,"framesSent")),e.track.frameRate=s?a(s/o*1e3):0),e[t][e.mediaType]=e}}else e[t][e.mediaType]=e}function i(e=0){const{length:t}=r;return e=Math.max(e,0),e=Math.min(e,t-1),r[e]}return{get quality(){return e},get inbound(){return t},get outbound(){return n},update:function(i){const s={},c={};let d=!1;i.forEach(e=>{switch("function"==typeof e.stat&&(d=!0),e.type){case"codec":break;case"inbound-rtp":e.isRemote&&!1!==e.isRemote||(s[e.mediaType]=a(i,e));break;case"outbound-rtp":e.isRemote&&!1!==e.isRemote||(c[e.mediaType]=a(i,e));break;case"ssrc":!function(e,t,n=!1){n&&(t.mediaType=t.stat("mediaType"),t.googCodecName=t.stat("googCodecName"),t.codecImplementationName=t.stat("codecImplementationName"),t.googFrameHeightReceived=t.stat("googFrameHeightReceived"),t.googFrameHeightSent=t.stat("googFrameHeightSent"),t.googFrameWidthReceived=t.stat("googFrameWidthReceived"),t.googFrameWidthSent=t.stat("googFrameWidthSent"),t.googFrameRateReceived=t.stat("googFrameRateReceived"),t.googFrameRateSent=t.stat("googFrameRateSent"),t.packetsLost=t.stat("packetsLost"),t.packetsSent=t.stat("packetsSent"),t.packetsReceived=t.stat("packetsReceived"),t.bytesSent=t.stat("bytesSent"),t.bytesReceived=t.stat("bytesReceived"));const r={name:t.googCodecName,implementationName:t.codecImplementationName},a={frameHeight:t.googFrameHeightReceived||t.googFrameHeightSent,frameWidth:t.googFrameWidthReceived||t.googFrameWidthSent,frameRate:t.googFrameRateReceived||t.googFrameRateSent};t.codec=r,t.track=a}(0,e,d),/recv/g.test(e.id)&&(s[e.mediaType]=e),/send/g.test(e.id)&&(c[e.mediaType]=e)}}),o(s.audio,"inbound"),o(s.video,"inbound"),o(c.audio,"outbound"),o(c.video,"outbound");let u=0,l=0;if(t.audio&&(l++,u+=t.audio.packetsLostRate||0),t.video&&(l++,u+=t.video.packetsLostRate||0),l){const t=u/l;e=t>=12?0:t>=5?1:t>=3?2:t>=2?3:4}!function(){10===r.length&&r.shift();r.push({quality:e,inbound:t,outbound:n})}()},clear:function(){e=-1,t={},n={},r=[]}}}const Le=t("MN:Channel"),xe=u();var Pe;!function(e){e[e.kNull=0]="kNull",e[e.kProgress=1]="kProgress",e[e.kOffered=2]="kOffered",e[e.kAnswered=3]="kAnswered",e[e.kAccepted=4]="kAccepted",e[e.kCanceled=5]="kCanceled",e[e.kTerminated=6]="kTerminated"}(Pe||(Pe={}));const $e=["audio","video"];function Fe(e){const{invite:t,confirm:n,cancel:r,bye:a}=e,o=P(Le);let i,s=Pe.kNull,c=!1;const d=Ie();let u,l,m,p=!1,f=!1,g=!1,h=!1,y=!1;function w(){if(c)throw new Error("Terminated");!function(e,t){if(s===e)throw new Error(t||"Invalid State")}(Pe.kTerminated,"Terminated")}async function k(e,t){let n;if(Le("createLocalDescription()"),f=!1,"offer"===e)try{n=await i.createOffer(t)}catch(e){throw Le("createOffer failed: %o",e),o.emit("peerconnection:createofferfailed",e),e}else{if("answer"!==e)throw new TypeError("Invalid Type");try{n=await i.createAnswer(t)}catch(e){throw Le("createAnswer failed: %o",e),o.emit("peerconnection:createanswerfailed",e),e}}try{await i.setLocalDescription(n)}catch(e){throw Le("setLocalDescription failed: %o",e),f=!0,o.emit("peerconnection:setlocaldescriptionfailed",e),e}await new Promise(e=>{if("complete"===i.iceGatheringState)return void e();let t,n=!1;const r=()=>{i.removeEventListener("icecandidate",t),n=!0,e()};i.addEventListener("icecandidate",t=e=>{const{candidate:t}=e;t?o.emit("icecandidate",{candidate:t,ready:r}):n||r()})}),f=!0;const{sdp:r}=i.localDescription;return n={originator:"local",type:e,sdp:r},o.emit("sdp",n),n.sdp}async function v(e){switch(Le("terminate()"),s){case Pe.kNull:case Pe.kTerminated:break;case Pe.kProgress:case Pe.kOffered:Le("canceling channel"),s===Pe.kOffered?await r(e):c=!0,s=Pe.kCanceled,T("local","Canceled");break;case Pe.kAnswered:case Pe.kAccepted:await a(e),t="local",n="Terminated",Le("channel ended"),b(),o.emit("ended",{originator:t,message:n})}var t,n}function b(){if(Le("close()"),s!==Pe.kTerminated){if(i)try{i.close(),i=void 0}catch(e){Le("error closing RTCPeerConnection %o",e)}m&&p&&Ne(m),m=void 0,p=!1,d.clear(),s=Pe.kTerminated}}function S(){let e=!0,t=!0;y&&(e=!1,t=!1),g&&(e=!1),h&&(t=!1),function(e){i.getSenders().forEach(t=>{t.track&&"audio"===t.track.kind&&(t.track.enabled=!e)})}(!e),function(e){i.getSenders().forEach(t=>{t.track&&"video"===t.track.kind&&(t.track.enabled=!e)})}(!t)}function T(e,t){Le("channel failed"),b(),o.emit("failed",{originator:e,message:t})}async function E(e={}){if(Le("renegotiate()"),!f)return void Le("RTC not ready");const n=await k("offer",l),r={originator:"remote",type:"answer",sdp:(await t({sdp:R(n)})).sdp};o.emit("sdp",r);try{i.setRemoteDescription({type:"answer",sdp:r.sdp})}catch(e){throw o.emit("peerconnection:setremotedescriptionfailed",e),e}}function R(e){if(Le("mangleOffer()"),!y)return e;const t=ve(e);if(y)for(const e of t.media)-1!==$e.indexOf(e.type)&&(e.direction?"sendrecv"===e.direction?e.direction="sendonly":"recvonly"===e.direction&&(e.direction="inactive"):e.direction="sendonly");else 0;return Ae(t)}function C(e){Le("addLocalStream()"),e&&(i.addTrack?e.getTracks().forEach(t=>{i.addTrack(t,e)}):i.addStream&&i.addStream(e))}function M(){Le("removeLocalStream()"),i.getSenders&&i.removeTrack?i.getSenders().forEach(e=>{e.track&&e.track.stop(),i.removeTrack(e)}):i.getLocalStreams&&i.removeStream&&i.getLocalStreams().forEach(e=>{e.getTracks().forEach(e=>{e.stop()}),i.removeStream(e)})}return{...o,get status(){return s},get connection(){return i},isInProgress:function(){switch(s){case Pe.kProgress:case Pe.kOffered:case Pe.kAnswered:return!0;default:return!1}},isEstablished:function(){return s===Pe.kAccepted},isEnded:function(){switch(s){case Pe.kCanceled:case Pe.kTerminated:return!0;default:return!1}},getMute:function(){return{audio:g,video:h}},getHold:function(){return{local:y,remote:!1}},connect:async function(e={}){if(Le("connect()"),function(e,t){if(s!==e)throw new Error(t||"Invalid State")}(Pe.kNull),!window.RTCPeerConnection)throw new Error("WebRTC not supported");var r,c;s=Pe.kProgress,r="local",Le("channel progress"),o.emit("progress",{originator:r,message:c}),o.emit("connecting"),({rtcConstraints:u={sdpSemantics:"plan-b",iceServers:[{urls:"stun:stun.l.google.com:19302"}]},rtcOfferConstraints:l={offerToReceiveAudio:!0,offerToReceiveVideo:!0}}=e);const{mediaStream:d,mediaConstraints:f={audio:!0,video:!0}}=e;!function(e){Le("createRTCConnection()"),i=new RTCPeerConnection(e),i.addEventListener("iceconnectionstatechange",()=>{if(!i)return;const{iceConnectionState:e}=i;"failed"===e&&(o.emit("peerconnection:connectionfailed"),v("RTP Timeout"))}),o.emit("peerconnection",i)}(u),d?(m=d,p=!1):(f.audio||f.video)&&(m=await Ue(f).catch(e=>{throw T("local","User Denied Media Access"),Le("getusermedia failed: %o",e),e}),p=!0),w(),m&&m.getTracks().forEach(e=>{i.addTrack(e,m)});const g=await k("offer",l).catch(e=>{throw T("local","WebRTC Error"),Le("createOff|setLocalDescription failed: %o",e),e});let h;w(),s=Pe.kOffered;try{h=await t({sdp:g})}catch(e){throw T("local","Request Error"),Le("invite failed: %o",e),e}w(),s=Pe.kAnswered;const{sdp:y}=h,b={originator:"remote",type:"answer",sdp:y};if(o.emit("sdp",b),"stable"===i.signalingState)try{const e=await i.createOffer();await i.setLocalDescription(e)}catch(e){throw T("local","WebRTC Error"),Le("createOff|setLocalDescription failed: %o",e),await a(),e}try{await i.setRemoteDescription({type:"answer",sdp:b.sdp})}catch(e){throw T("local","Bad Media Description"),o.emit("peerconnection:setremotedescriptionfailed",e),Le("setRemoteDescription failed: %o",e),await a(),e}try{await n()}catch(e){throw T("local","Request Error"),Le("confirm failed: %o",e),e}s=Pe.kAccepted,function(e,t){Le("channel accepted"),o.emit("accepted",{originator:e,message:t})}("local"),o.emit("connected")},terminate:v,renegotiate:E,mute:function(e={audio:!0,video:!1}){Le("mute()");let t=!1;!1===g&&e.audio&&(t=!0,g=!0),!1===h&&e.video&&(t=!0,h=!0),t&&(S(),o.emit("mute",{audio:g,video:h}))},unmute:function(e={audio:!0,video:!0}){Le("unmute()");let t=!1;!0===g&&e.audio&&(t=!0,g=!1),!0===h&&e.video&&(t=!0,h=!1),t&&(S(),o.emit("unmute",{audio:!g,video:!h}))},hold:async function(){var e;Le("unhold()"),y?Le("Already hold"):(y=!0,e="local",S(),o.emit("hold",{originator:e,localHold:y,remoteHold:!1}),await E())},unhold:async function(){var e;Le("unhold()"),y?(y=!1,e="local",S(),o.emit("unhold",{originator:e,localHold:y,remoteHold:!1}),await E()):Le("Already unhold")},getRemoteStream:function(){let e;return Le("getRemoteStream()"),i.getReceivers?(e=new window.MediaStream,i.getReceivers().forEach(t=>{const{track:n}=t;n&&e.addTrack(n)})):i.getRemoteStreams&&(e=i.getRemoteStreams()[0]),e},addLocalStream:C,removeLocalStream:M,getLocalStream:function(){let e;return Le("getLocalStream()"),i.getSenders?(e=new window.MediaStream,i.getSenders().forEach(t=>{const{track:n}=t;n&&e.addTrack(n)})):i.getLocalStreams&&(e=i.getLocalStreams()[0]),e},setLocalStream:function(e){M(),C(e)},replaceLocalStream:async function(e,t=!1){Le("replaceLocalStream()");const n=e?e.getAudioTracks()[0]:null,r=e?e.getVideoTracks()[0]:null,a=[];let o=!1,s=!1,c=!1;i.getSenders&&(i.getSenders().forEach(e=>{e.track&&(s="audio"===e.track.kind||s,c="video"===e.track.kind||c)}),o=Boolean(n)!==s||Boolean(r)!==c||t,o?(M(),C(e),a.push(E())):i.getSenders().forEach(t=>{t.track&&(t.replaceTrack||t.prototype&&t.prototype.replaceTrack||function(t){t.replaceTrack=async function(n){i.removeTrack(t),i.addTrack(n,e);const r=await i.createOffer();r.type=i.localDescription.type,r.sdp=function(e,t){let n=e.match(/a=ssrc-group:FID (\d+) (\d+)\r\n/),r=t.match(/a=ssrc-group:FID (\d+) (\d+)\r\n/);n||(n=e.match(/a=ssrc:(\d+) cname:(.*)\r\n/g)[1].match(/a=ssrc:(\d+)/),r=t.match(/a=ssrc:(\d+) cname:(.*)\r\n/g)[1].match(/a=ssrc:(\d+)/));for(let e=1;e<n.length;e++)t=t.replace(new RegExp(r[e],"g"),n[e]);return t}(i.localDescription.sdp,r.sdp),await i.setLocalDescription(r),await i.setRemoteDescription(i.remoteDescription)}}(t),n&&"audio"===t.track.kind&&a.push(t.replaceTrack(n).catch(e=>{Le("replace audio track error: %o",e)})),r&&"video"===t.track.kind&&a.push(t.replaceTrack(r).catch(e=>{Le("replace video track error: %o",e)})))})),await Promise.all(a)},adjustBandWidth:async function(e){Le("adjustBandWidth()");const{audio:t,video:n}=e,r=[];"RTCRtpSender"in window&&"setParameters"in window.RTCRtpSender.prototype?i.getSenders().forEach(e=>{if(e.track)return;const a=e.getParameters();void 0!==t&&"audio"===e.track.kind&&(0===t?delete a.encodings[0].maxBitrate:a.encodings[0].maxBitrate=1024*t,r.push(e.setParameters(a).catch(e=>{Le("apply audio parameters error: %o",e)}))),void 0!==n&&"video"===e.track.kind&&(0===n?delete a.encodings[0].maxBitrate:a.encodings[0].maxBitrate=1024*n,r.push(e.setParameters(a).catch(e=>{Le("apply video parameters error: %o",e)})))}):r.push(i.createOffer().then(e=>i.setLocalDescription(e)).then(()=>{const e=ve(i.remoteDescription.sdp);for(const r of e.media)void 0!==t&&"audio"===r.type&&(r.bandwidth=0===t?[]:[{type:"TIAS",limit:Math.ceil(1024*t)}]),void 0!==n&&"video"===r.type&&(r.bandwidth=0===n?[]:[{type:"TIAS",limit:Math.ceil(1024*n)}]);const r={type:i.remoteDescription.type,sdp:Ae(e)};return i.setRemoteDescription(r)}).catch(e=>{Le("applying bandwidth restriction to setRemoteDescription error: %o",e)})),await Promise.all(r)},applyConstraints:async function(e){Le("applyConstraints()");const{audio:t,video:n}=e,r=[];i.getSenders&&window.MediaStreamTrack.prototype.applyConstraints&&i.getSenders().forEach(e=>{t&&e.track&&"audio"===e.track.kind&&r.push(e.track.applyConstraints(t).catch(e=>{Le("apply audio constraints error: %o",e)})),n&&e.track&&"video"===e.track.kind&&r.push(e.track.applyConstraints(n).catch(e=>{Le("apply video constraints error: %o",e)}))}),await Promise.all(r)},getStats:async function(){if(Le("getStats()"),"stable"===i.signalingState){let e;e=xe.chrome?await new Promise(e=>{i.getStats(t=>{e(t.result())})}):await i.getStats(),d.update(e)}else Le("update rtc stats failed since connection is unstable.");return d}}}const Oe=t("MN:SDP"),De=u();const qe=t("MN:MediaChannel");function je(e){const{api:t,type:n="main"}=e;let r,a,o,i,s,c;const d=Fe({invite:async e=>{qe("invite()");let{sdp:i}=e;const s=r?"main"===n?"renegMedia":"renegShare":"main"===n?"joinMedia":"joinShare";o=t.request(s).data({sdp:i,"media-version":r});const c=await o.send();return({sdp:i,"media-version":r,"mcu-callid":a}=c.data.data),qe("MCU call-id: %s",a),{sdp:i}},confirm:()=>{qe("confirm()"),o=void 0,s=d.getLocalStream(),d.emit("localstream",s)},cancel:()=>{qe("cancel()"),o&&o.cancel()},bye:()=>{qe("bye()"),o=void 0}});return d.on("sdp",function(){let e,t,n,r="main",a=1920,o=1080,i=30,s=!1;return n={content:e=>(r=e,n),width:e=>(a=e,n),height:e=>(o=e,n),frameRate:e=>(i=e,n),highFrameRate:e=>(s=e,n),prefer:t=>(e=t,n),unsupport:e=>(t=e,n),build:function(){return n=>{const{originator:c,type:d}=n,u=ve(n.sdp),l=a,m=o,p=i,f=Math.ceil(l*m/255),g=Math.ceil(p*f);let h=m>=1080?2048:m>=720?1280:512;h=Math.ceil(h*p/30);for(const n of u.media){if("video"===n.type){n.content=r,n.bandwidth=[{type:"TIAS",limit:Math.ceil(1024*h)}];const a=new Set,o=new Set,i=[`max-fr=${p}`,`max-fs=${f}`],u=[`max-mbps=${g}`,`max-fs=${f}`];for(const e of n.rtp){let t;switch(e.codec.toUpperCase()){case"VP8":case"VP9":a.add(Number(e.payload)),t=n.fmtp.find(t=>t.payload===e.payload),t?t.config=t.config.split(";").filter(e=>!(/^max-fr/.test(e)||/^max-fs/.test(e))).concat(i).join(";"):n.fmtp.push({payload:e.payload,config:i.join(";")});break;case"H264":o.add(Number(e.payload)),t=n.fmtp.find(t=>t.payload===e.payload),t?s&&-1!==t.config.indexOf("profile-level-id=42e01f")&&"local"===c&&"offer"===d?t.config=t.config.split(";").filter(e=>!(/^max-mbps/.test(e)||/^max-fs/.test(e)||/^profile-level-id/.test(e))).concat(["profile-level-id=64001f"]).concat(u).join(";"):s&&-1!==t.config.indexOf("profile-level-id=64001f")&&"remote"===c&&"answer"===d?t.config=t.config.split(";").filter(e=>!(/^max-mbps/.test(e)||/^max-fs/.test(e)||/^profile-level-id/.test(e))).concat(["profile-level-id=42e01f"]).concat(u).join(";"):t.config=t.config.split(";").filter(e=>!(/^max-mbps/.test(e)||/^max-fs/.test(e))).concat(u).join(";"):n.fmtp.push({payload:e.payload,config:u.join(";")})}}for(const e of n.fmtp){const t=e.config.split(";").find(e=>/^apt=/.test(e));if(!t)continue;const n=t.split("=")[1];a.has(Number(n))?a.add(Number(e.payload)):o.has(Number(n))&&o.add(Number(e.payload))}let l="vp8"===e?a:"h264"===e?o:new Set;const m="vp8"===t?a:"h264"===t?o:new Set;if((De.firefox||De.chrome&&parseInt(De.version,10)<63&&"slides"===r)&&(l=a),!l.size||!m.size){let e=String(n.payloads).split(" ");e=e.filter(e=>!l.has(Number(e))),e=e.filter(e=>!m.has(Number(e))),e=Array.from(l).sort((e,t)=>e-t).concat(e),n.rtp=n.rtp.filter(e=>!m.has(Number(e.payload))),n.fmtp=n.fmtp.filter(e=>!m.has(Number(e.payload)));const t=[],r=[];e.forEach(e=>{const a=n.rtp.find(t=>t.payload===Number(e)),o=n.fmtp.find(t=>t.payload===Number(e));a&&t.push(a),o&&r.push(o)}),n.rtp=t,n.fmtp=r,n.payloads=e.join(" ")}}"audio"===n.type&&(n.bandwidth=[{type:"TIAS",limit:Math.ceil(131072)}])}u.media=u.media.filter(e=>"application"!==e.type||/TLS/.test(e.protocol)),"remote"===c&&(u.media.forEach(e=>{const t=String(e.payloads).split(" ");if(e.rtcpFb){const n=[];e.rtcpFb.forEach(e=>{("*"===e.payload||t.includes(`${e.payload}`))&&n.push(e)}),e.rtcpFb=n}if(e.fmtp){const n=[];e.fmtp.forEach(e=>{("*"===e.payload||t.includes(`${e.payload}`))&&n.push(e)}),e.fmtp=n}if(e.rtp){const n=[];e.rtp.forEach(e=>{("*"===e.payload||t.includes(`${e.payload}`))&&n.push(e)}),e.rtp=n}}),"offer"===d&&De.firefox&&u.media.forEach(e=>{void 0===e.mid&&(e.mid="audio"===e.type?0:"video"===e.type?1:e.mid)})),n.sdp=Ae(u),Oe(`${c} sdp: \n\n %s \n`,n.sdp)}}}}().content(n).prefer("h264").build()),d.on("peerconnection",e=>{e.addEventListener("connectionstatechange",()=>{qe("peerconnection:connectionstatechange : %s",e.connectionState)}),e.addEventListener("iceconnectionstatechange",()=>{qe("peerconnection:iceconnectionstatechange : %s",e.iceConnectionState)}),e.addEventListener("icegatheringstatechange",()=>{qe("peerconnection:icegatheringstatechange : %s",e.iceGatheringState)}),e.addEventListener("negotiationneeded",()=>{qe("peerconnection:negotiationneeded")}),e.addEventListener("track",e=>{qe("peerconnection:track: %o",e),c=e.streams[0],d.emit("remotestream",c)}),e.addEventListener("addstream",e=>{qe("peerconnection:addstream: %o",e),c=e.stream,d.emit("remotestream",c)}),e.addEventListener("removestream",e=>{qe("peerconnection:removestream: %o",e),c=d.getRemoteStream(),d.emit("remotestream",c)})}),d.on("icecandidate",e=>{const{candidate:t,ready:n}=e;i&&(clearTimeout(i),i=void 0),t&&(i=setTimeout(()=>{qe("ICE gathering timeout in 3 seconds"),n()},3e3))}),{...d,get version(){return r},get callId(){return a}}}var Be;!function(e){e[e.kNull=0]="kNull",e[e.kSending=1]="kSending",e[e.kSuccess=2]="kSuccess",e[e.kFailed=3]="kFailed"}(Be||(Be={}));const ze=t("MN:Message");function Ve(e){const{api:t,onSucceeded:n,onFailed:r}=e;let a,o,i,s,c,d,u,l=Be.kNull,m="outgoing",p=e.sender;async function f(e,c){if(ze("send()"),"incoming"===m)throw new Error("Invalid Status");let d;l=Be.kSending,u=t.request("pushMessage").data({"im-context":e,"user-entity-list":c});try{d=await u.send()}catch(t){throw l=Be.kFailed,r&&r(e),t}const{data:p}=d;a=e,s=c,({"im-version":i,"im-timestamp":o}=p.data),l=Be.kSuccess,n&&n(e)}return d={get status(){return l},get direction(){return m},get content(){return a},get timestamp(){return o},get version(){return i},get sender(){return p},get receiver(){return s},get private(){return s&&s.length>0||c},send:f,retry:async function(){if(ze("retry()"),!a)throw new Error("Invalid Message");await f(a,s)},cancel:function(){ze("cancel()"),u&&(u.cancel(),u=void 0)},incoming:function(e){return m="incoming",a=e["im-context"],o=e["im-timestamp"],i=e["im-version"],c=e["is-private"],p={entity:e["sender-entity"],subjectId:e["sender-subject-id"],displayText:e["sender-display-text"]},d}}}const _e=t("MN:ChatChannel");const He=t("MN:Conference"),We=l(),Ge=u();function Ze(t){const{api:n}=t,r=P(He);let a,o,i,s,c,d,u,l,p,f,g,h,y,w=e.STATUS.kNull;function k(){return p||(p=i.users.getCurrent(),p&&(r.emit("user",p),p.on("holdChanged",E))),p}function v(e,t){if(w===e)throw new Error(t||"Invalid State")}function b(e,t){if(w!==e)throw new Error(t||"Invalid State")}function S(){He("conference connected"),function(){k();const{state:e,users:t}=i;e.on("sharingUserEntityChanged",e=>{r.emit("sharinguser",t.getUser(e))}),e.on("speechUserEntityChanged",e=>{r.emit("speechuser",t.getUser(e))}),t.on("user:added",(...e)=>r.emit("user:added",...e)),t.on("user:updated",(...e)=>r.emit("user:updated",...e)),t.on("user:deleted",(...e)=>r.emit("user:deleted",...e)),a=F({api:n}),o=D({api:n,onInformation:e=>{He("receive information: %o",e),i.update(e),r.emit("information",i),k()},onMessage:e=>{He("receive message: %o",e),l.incoming(e)},onRenegotiate:e=>{He("receive renegotiate: %o",e),d.renegotiate()},onQuit:e=>{He("receive quit: %o",e),T(e)},onError:e=>{He("polling error, about to leave..."),r.emit("error",e),T(e)}}),a.start(),o.start(),d=je({api:n,type:"main"}),u=je({api:n,type:"slides"}),l=function(e){const{api:t}=e,n=P(_e);let r,a=[],o=!1;return{...n,get ready(){return o},connect:async function(e=2e3){if(_e("connect()"),o)return;r=t.request("pullMessage").data({count:e});const i=await r.send(),{data:s}=i.data;a=s.imInfos.map(e=>Ve({api:t}).incoming(e)),o=!0,n.emit("ready"),n.emit("connected")},terminate:async function(){_e("terminate()"),a=[],o=!1,r&&(r.cancel(),r=void 0),n.emit("disconnected")},sendMessage:async function(e,r){_e("sendMessage()");const o=Ve({api:t});return n.emit("message",{originator:"local",message:o}),await o.send(e,r),a.push(o),o},incoming:function(e){_e("incoming()");const r=Ve({api:t}).incoming(e);return n.emit("message",{originator:"remote",message:r}),a.push(r),r}}}({api:n}),l.on("message",(...e)=>r.emit("message",...e)),l.on("ready",(...e)=>r.emit("chatready",...e)),E()}(),w=e.STATUS.kConnected,r.emit("connected")}function T(t){He("conference disconnected"),function(){a&&a.stop();o&&o.stop();s&&n.interceptors.request.eject(s);d&&d.terminate();u&&u.terminate();l&&l.terminate();y=void 0}(),w=e.STATUS.kDisconnected,r.emit("disconnected",t)}async function E(){l&&(l.ready||await l.connect().catch(()=>{}))}async function R(){switch(v(e.STATUS.kDisconnecting),v(e.STATUS.kDisconnected),w){case e.STATUS.kNull:break;case e.STATUS.kConnecting:case e.STATUS.kConnected:w===e.STATUS.kConnected?(He("conference disconnecting"),w=e.STATUS.kDisconnecting,r.emit("disconnecting"),await n.request("leave").send(),T()):y&&(y.cancel(),T());break;case e.STATUS.kDisconnecting:case e.STATUS.kDisconnected:}return c}return c={...r,get api(){return n},get url(){return h},get uuid(){return f},get userId(){return`${g}`},get user(){return p},get information(){return i},get description(){return i&&i.description},get state(){return i&&i.state},get view(){return i&&i.view},get users(){return i&&i.users},get rtmp(){return i&&i.rtmp},get record(){return i&&i.record},get mediaChannel(){return d},get shareChannel(){return u},get chatChannel(){return l},join:async function(t={}){if(He("join()"),b(e.STATUS.kNull),!t.url&&!t.number)throw new TypeError("Invalid Number");let a,o;w=e.STATUS.kConnecting,He("conference connecting"),w=e.STATUS.kConnecting,r.emit("connecting"),!t.url&&t.number&&(y=n.request("getURL").data({"long-number":t.number}),a=await y.send(),({data:o}=a),({url:t.url}=o.data));const d=m.get("useragent",`Yealink ${We?"WECHAT":"WEB-APP"} ${process.env.VUE_APP_VERSION}`),u=m.get("clientinfo",`${We?"Apollo_WeChat":"Apollo_WebRTC"} ${process.env.VUE_APP_VERSION}`),l=We?"joinWechat":"joinFocus";y=n.request(l).data({"conference-url":t.url,"conference-pwd":t.password,"user-agent":d,"client-url":t.url.replace(/\w+@/g,We?"wechat@":"webrtc@"),"client-display-text":t.displayName||`${Ge}`,"client-type":"http","client-info":u,"pure-ctrl-channel":!1,"is-webrtc":!We&&!0,"is-wechat":We,"video-session-info":We&&{bitrate:614400,"video-width":640,"video-height":480,"frame-rate":15}});try{a=await y.send()}catch(e){throw r.emit("failed",e),e}if(({data:o}=a),({"conference-user-id":g,"conference-uuid":f}=o.data),!g||!f)throw He("internal error"),new Error("Internal Error");({url:h}=t),s=n.interceptors.request.use(e=>(/conference-ctrl/.test(e.url)&&"post"===e.method&&(e.data={"conference-user-id":g,"conference-uuid":f,...e.data}),e)),y=n.request("getFullInfo");try{a=await y.send()}catch(e){throw r.emit("failed",e),e}({data:o}=a);const p=o.data,k=(v=c,new Proxy({},{get:(e,t)=>t in e?e[t]:Reflect.get(v,t)}));var v;return i=ge(p,k),S(),c},leave:R,end:async function(){return b(e.STATUS.kConnected),await R(),await n.request("end").data({"conference-url":h}).send(),c},share:async function(t){b(e.STATUS.kConnected),u.isInProgress()||u.isEstablished()||await u.connect(t),await n.request("switchShare").data({share:!0}).send()},sendMessage:async function(t,n){if(b(e.STATUS.kConnected),!l||!l.ready)throw new Error("Not Ready");await l.sendMessage(t,n)}}}!function(e){e[e.kNull=0]="kNull",e[e.kConnecting=1]="kConnecting",e[e.kConnected=2]="kConnected",e[e.kDisconnecting=3]="kDisconnecting",e[e.kDisconnected=4]="kDisconnected"}(e.STATUS||(e.STATUS={}));const Je=t("MN:UA");function Qe(e){let t,n,r,a,o;function i(){const e=E({baseURL:m.get("baseurl",process.env.VUE_APP_BASEURL)});return e.interceptors.request.use(e=>(r&&(e.headers=e.headers||{},e.headers.token=r),e)),e}function s(){Je("stop()"),n&&n.stop(),r=void 0}return{stop:s,fetch:async function(e){let n,r,a,o,i;Je("fetch()"),n=await t.request("getURL").data({"long-number":e}).send(),({data:r}=n),({"party-id":o,url:i}=r.data);try{n=await t.request("getBasicInfo").data({"conference-url":i}).send(),({data:r}=n),a=r.data}catch(o){Je("Conference not started.");try{n=await t.request("getBasicInfoOffline").data({"long-number":e}).send(),({data:r}=n),a=r.data}catch(e){Je("Conference not exist.")}}if(!a)throw new Error("Not Exist");return{partyId:o,number:e,url:i,info:a}},connect:async function(e){if(Je("connect()"),t||(t=i()),n||(n=L({interval:3e5,work:async()=>{await async function(){if(Je("auth()"),!a)throw new Error("Authorization Error");const e=await t.request("getVirtualJWT").params({id:a}).send();if(({token:r}=e.data.data),!r)throw new Error("Authorization Error")}()}})),!e.number)throw new TypeError("Invalid Number");const{number:c}=e,d=await t.request("getURL").data({"long-number":c}).send(),{data:u}=d;({"party-id":a,url:o}=u.data),await n.start();const l=Ze({api:i()}),{join:m}=l;return l.join=t=>m({url:o,...e,...t}),l.once("disconnected",s),l}}}const Ke=t("MN"),Ye=process.env.VUE_APP_VERSION;var Xe={version:Ye,createUA:Qe,setup:function(){g(),l(),t.enable(m.get("debug","MN*,-MN:Api*,-MN:Information:Item,-MN:Worker")),Ke("setup() [version]: %s",Ye)},connect:async function(e){const t=Qe();return await t.connect(e)}};return e.debug=t,e.axios=n,e.createChannel=function(e){return{open(){},close(e){}}},e.createConference=Ze,e.createEvents=P,e.createMedia=function(){return{}},e.createReactive=j,e.createUA=Qe,e.default=Xe,e.paramReducer=be,e.parse=ve,e.parseFmtpConfig=Te,e.parseImageAttributes=function(e){return e.split(" ").map(e=>e.substring(1,e.length-1).split(",").reduce(be,{}))},e.parseParams=Se,e.parsePayloads=function(e){return e.split(" ").map(Number)},e.parseReg=we,e.parseRemoteCandidates=function(e){const t=[],n=e.split(" ").map(ye);for(let e=0;e<n.length;e+=3)t.push({component:n[e],ip:n[e+1],port:n[e+2]});return t},e.parseSimulcastStreamList=function(e){return e.split(";").map(e=>e.split(",").map(e=>{let t,n=!1;return"~"!==e[0]?t=ye(e):(t=ye(e.substring(1,e.length)),n=!0),{scid:t,paused:n}}))},e.urlToNumber=function(e){const t=e.split("@");return`${t[0]}.${t[1].split(".")[0]}`},e.write=Ae,e}({},debug,axios);
